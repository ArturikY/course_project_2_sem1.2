# Инструкция по использованию

## Запуск веб-приложения

### 1. Настройка XAMPP

1. Убедитесь, что XAMPP запущен (Apache + MySQL)
2. Скопируйте папку проекта в `C:\xampp\htdocs\` или настройте виртуальный хост

### 2. Проверка настроек API

Откройте `api/config.php` и при необходимости измените настройки подключения к БД:

```php
'database' => [
    'host' => 'localhost',
    'dbname' => 'dtp_analysis',
    'user' => 'root',
    'pass' => '', // Ваш пароль если есть
    'charset' => 'utf8mb4'
],
```

### 3. Запуск приложения

Откройте в браузере:
```
http://localhost/course_project2/index.html
```

Или если проект в корне htdocs:
```
http://localhost/index.html
```

## Функционал

### Карта с данными о ДТП

- **Отображение ДТП**: точки на карте с информацией при клике
- **Опасные зоны**: выделенные участки с высоким количеством ДТП
- **Фильтры**:
  - Период (7/30/90/365 дней)
  - Порог опасности (минимальное количество ДТП для зоны)
  - Включение/выключение слоев

### API Endpoints

#### 1. Получение ДТП
```
GET /api/accidents.php?bbox=minLon,minLat,maxLon,maxLat&from=YYYY-MM-DD&to=YYYY-MM-DD&limit=1000
```

**Параметры:**
- `bbox` (обязательный) - границы области в формате minLon,minLat,maxLon,maxLat
- `from` (опционально) - начальная дата (YYYY-MM-DD)
- `to` (опционально) - конечная дата (YYYY-MM-DD)
- `limit` (опционально) - максимальное количество записей (по умолчанию 1000)

**Пример:**
```
http://localhost/course_project2/api/accidents.php?bbox=37.3,55.5,37.8,56.0&from=2023-01-01&limit=500
```

#### 2. Получение опасных зон
```
GET /api/hotspots.php?bbox=minLon,minLat,maxLon,maxLat&period=30d&threshold=5&grid=250
```

**Параметры:**
- `bbox` (обязательный) - границы области
- `period` (опционально) - период анализа (7d, 30d, 90d, 365d, по умолчанию 30d)
- `threshold` (опционально) - минимальное количество ДТП для зоны (по умолчанию 5)
- `grid` (опционально) - размер ячейки сетки в метрах (по умолчанию 250)

**Пример:**
```
http://localhost/course_project2/api/hotspots.php?bbox=37.3,55.5,37.8,56.0&period=90d&threshold=10
```

## Структура проекта

```
course_project2/
├── api/
│   ├── config.php          # Конфигурация
│   ├── db.php              # Подключение к БД
│   ├── accidents.php       # API для получения ДТП
│   └── hotspots.php        # API для получения опасных зон
├── index.html              # Главная страница с картой
├── import_ndjson.php      # Скрипт импорта данных
├── import_test.php         # Тестовый импорт
├── schema.sql              # Схема БД
└── README.md               # Общая документация
```

## Возможные проблемы

### CORS ошибки
Если возникают проблемы с CORS, убедитесь, что API файлы имеют заголовки:
```php
header('Access-Control-Allow-Origin: *');
```

### Данные не загружаются
1. Проверьте, что MySQL запущен и БД содержит данные
2. Проверьте настройки в `api/config.php`
3. Откройте консоль браузера (F12) для просмотра ошибок

### Карта не отображается
1. Проверьте подключение к интернету (Leaflet загружается с CDN)
2. Проверьте консоль браузера на наличие ошибок JavaScript

## Следующие шаги

- [ ] Добавить функционал сравнения маршрутов
- [ ] Добавить экспорт данных
- [ ] Добавить фильтры по категориям/тяжести ДТП
- [ ] Добавить статистику по районам








