<!doctype html>
<html lang="ru">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>–ê–Ω–∞–ª–∏–∑ –î–¢–ü –≤ –ú–æ—Å–∫–≤–µ</title>

		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
				height: 100vh;
				background: #f5f5f5;
				overflow: hidden;
			}

			.checkbox-group input[type='checkbox'] {
				width: 18px;
				height: 18px;
				cursor: pointer;
			}

			.btn {
				width: 100%;
				padding: 0.9rem;
				background: rgba(255, 255, 255, 0.25);
				color: white;
				border: 2px solid rgba(255, 255, 255, 0.3);
				border-radius: 8px;
				cursor: pointer;
				font-size: 1rem;
				font-weight: 600;
				transition: all 0.3s;
				backdrop-filter: blur(10px);
				margin-bottom: 1rem;
			}

			.btn:hover {
				background: rgba(255, 255, 255, 0.35);
				border-color: rgba(255, 255, 255, 0.5);
				transform: translateY(-2px);
			}

			.btn:active {
				transform: translateY(0);
			}

			.btn-route {
				background: rgba(46, 204, 113, 0.3);
				border-color: rgba(46, 204, 113, 0.5);
			}

			.btn-route:hover {
				background: rgba(46, 204, 113, 0.4);
			}

			.stats-grid {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 1rem;
				margin-top: 1rem;
			}

			.stat-card {
				background: rgba(255, 255, 255, 0.15);
				backdrop-filter: blur(10px);
				border-radius: 10px;
				padding: 1rem;
				text-align: center;
			}

			.stat-value {
				font-size: 2rem;
				font-weight: 700;
				margin-bottom: 0.3rem;
			}

			.stat-label {
				font-size: 0.8rem;
				opacity: 0.9;
			}

			/* –ö–∞—Ä—Ç–∞ */
			.map-container {
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: #e0e0e0;
			}

			#map {
				width: 100%;
				height: 100%;
			}

			/* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –ª–µ–≥–µ–Ω–¥–∞ */
			.legend {
				position: absolute;
				bottom: 20px;
				right: 20px;
				background: white;
				padding: 1.5rem;
				border-radius: 12px;
				box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
				z-index: 1000;
				min-width: 280px;
				max-width: 320px;
			}

			.legend h3 {
				margin-bottom: 1rem;
				font-size: 1.1rem;
				color: #333;
				font-weight: 600;
			}

			.legend-form {
				margin-bottom: 1.5rem;
				padding-bottom: 1.5rem;
				border-bottom: 1px solid #eee;
			}

			.legend-form-group {
				margin-bottom: 1rem;
			}

			.legend-form-group:last-child {
				margin-bottom: 0;
			}

			.legend-form-group label {
				display: block;
				font-size: 0.85rem;
				color: #666;
				margin-bottom: 0.5rem;
				font-weight: 500;
			}

			.legend-form-group select,
			.legend-form-group input[type='number'] {
				width: 100%;
				padding: 0.6rem;
				border: 1px solid #ddd;
				border-radius: 8px;
				font-size: 0.9rem;
				background: #f9f9f9;
				color: #333;
				transition: all 0.2s;
			}

			.legend-form-group select:focus,
			.legend-form-group input[type='number']:focus {
				outline: none;
				border-color: #667eea;
				background: white;
				box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
			}

			.legend-item {
				display: flex;
				align-items: center;
				gap: 0.8rem;
				margin: 0.5rem 0;
			}

			.legend-color {
				width: 24px;
				height: 24px;
				border-radius: 6px;
				border: 2px solid rgba(0, 0, 0, 0.1);
				flex-shrink: 0;
			}

			.legend-item span {
				font-size: 0.85rem;
				color: #555;
			}

			/* –ó–∞–≥—Ä—É–∑–∫–∞ */
			.loading {
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				background: white;
				padding: 2rem 3rem;
				border-radius: 16px;
				box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
				z-index: 2000;
				display: none;
				text-align: center;
			}

			.loading.active {
				display: block;
			}

			.loading-spinner {
				border: 4px solid #f3f3f3;
				border-top: 4px solid #667eea;
				border-radius: 50%;
				width: 40px;
				height: 40px;
				animation: spin 1s linear infinite;
				margin: 0 auto 1rem;
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}

			.loading-text {
				color: #667eea;
				font-weight: 600;
			}

			/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å */
			.info-panel {
				position: absolute;
				top: 20px;
				left: 20px;
				background: white;
				padding: 1rem 1.5rem;
				border-radius: 12px;
				box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
				z-index: 1000;
				font-size: 0.9rem;
				max-width: 300px;
			}

			.info-panel h4 {
				color: #667eea;
				margin-bottom: 0.5rem;
				font-size: 1rem;
			}

			.info-panel p {
				color: #666;
				line-height: 1.6;
				font-size: 0.85rem;
			}

			.route-info {
				background: rgba(46, 204, 113, 0.1);
				border-left: 3px solid #2ecc71;
				padding: 0.8rem;
				margin-top: 1rem;
				border-radius: 6px;
				font-size: 0.85rem;
			}

			/* –ü–∞–Ω–µ–ª—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ */
			.route-safety-panel {
				position: fixed;
				top: 20px;
				left: 20px;
				background: white;
				padding: 1.5rem;
				border-radius: 12px;
				box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
				z-index: 2000;
				max-width: 400px;
				max-height: 80vh;
				overflow-y: auto;
			}

			.route-safety-panel h3 {
				margin: 0 0 1rem 0;
				color: #333;
				font-size: 1.2rem;
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			.route-safety-panel .close-btn {
				background: #e74c3c;
				color: white;
				border: none;
				border-radius: 50%;
				width: 24px;
				height: 24px;
				cursor: pointer;
				font-size: 16px;
				line-height: 1;
				display: flex;
				align-items: center;
				justify-content: center;
				padding: 0;
			}

			.route-safety-panel .close-btn:hover {
				background: #c0392b;
			}

			.route-result {
				transition:
					transform 0.2s,
					box-shadow 0.2s;
			}

			.route-result:hover {
				transform: translateY(-2px);
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
			}

			@media (max-width: 768px) {
				.legend {
					bottom: 10px;
					right: 10px;
					left: 10px;
					max-width: none;
				}
			}

			/* –°–∫—Ä—ã—Ç–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç */
			/* –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π API */
			[class*="copyrights-pane"],
			[class*="copyright"],
			[class*="copyright__wrap"],
			[class*="copyright__content"],
			[class*="copyright__link"],
			[class*="copyright__text"],
			.ymaps-2-1-79-copyrights-pane,
			.ymaps-2-1-79-copyright,
			.ymaps-2-1-79-controls__control_toolbar,
			.ymaps-2-1-79-float-button,
			.ymaps-2-1-79-controls__control[data-control-id="toolbar"],
			.ymaps-2-1-79-copyright__wrap,
			.ymaps-2-1-79-copyright__content,
			.ymaps-2-1-79-copyright__link,
			.ymaps-2-1-79-copyright__text {
				display: none !important;
				visibility: hidden !important;
				opacity: 0 !important;
			}
		</style>
	</head>
	<body>
		<!-- –ö–∞—Ä—Ç–∞ -->
		<div class="map-container">
			<div id="map"></div>

			<div class="loading" id="loading">
				<div class="loading-spinner"></div>
				<div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
			</div>

			<div class="legend">
				<h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>

				<!-- –§–æ—Ä–º–∞ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ -->
				<div class="legend-form">
					<div class="legend-form-group">
						<label for="gridSize">–†–∞–∑–º–µ—Ä —è—á–µ–π–∫–∏ —Å–µ—Ç–∫–∏ (–º–µ—Ç—Ä—ã)</label>
						<input
							type="number"
							id="gridSize"
							value="1000"
							min="50"
							max="2000"
							step="50"
						/>
						<small
							style="
								color: #999;
								font-size: 0.75rem;
								display: block;
								margin-top: 0.25rem;
							"
						>
							‚ÑπÔ∏è –î–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 1000 –º
						</small>
					</div>

					<div class="legend-form-group">
						<label for="routeFrom">–¢–æ—á–∫–∞ A (–æ—Ç–∫—É–¥–∞)</label>
						<input
							type="text"
							id="routeFrom"
							placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è"
							value=""
							style="
								width: 100%;
								padding: 0.5rem;
								border: 1px solid #ddd;
								border-radius: 6px;
								font-size: 0.9rem;
								margin-top: 0.25rem;
							"
						/>
					</div>

					<div class="legend-form-group">
						<label for="routeTo">–¢–æ—á–∫–∞ B (–∫—É–¥–∞)</label>
						<input
							type="text"
							id="routeTo"
							placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è"
							value=""
							style="
								width: 100%;
								padding: 0.5rem;
								border: 1px solid #ddd;
								border-radius: 6px;
								font-size: 0.9rem;
								margin-top: 0.25rem;
							"
						/>
					</div>

					<div class="legend-form-group">
						<button
							type="button"
							onclick="buildAndAnalyzeRoute()"
							style="
								width: 100%;
								padding: 0.6rem;
								background: #2ecc71;
								color: white;
								border: none;
								border-radius: 8px;
								cursor: pointer;
								font-size: 0.9rem;
								font-weight: 600;
								margin-top: 0.5rem;
							"
						>
							üìä –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç
						</button>
						<small
							style="
								color: #999;
								font-size: 0.75rem;
								display: block;
								margin-top: 0.25rem;
							"
						>
							–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å–∞ –≤—ã—à–µ –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É
						</small>
					</div>

				</div>

				<!-- –õ–µ–≥–µ–Ω–¥–∞ —É—Ä–æ–≤–Ω–µ–π –æ–ø–∞—Å–Ω–æ—Å—Ç–∏ -->
				<div>
					<h3
						style="
							margin-bottom: 1rem;
							font-size: 1rem;
							color: #333;
							font-weight: 600;
						"
					>
						üé® –£—Ä–æ–≤–µ–Ω—å –æ–ø–∞—Å–Ω–æ—Å—Ç–∏
					</h3>
					<div class="legend-item">
						<div class="legend-color" style="background: #fff9c4"></div>
						<span><strong>–ù–∏–∑–∫–∏–π</strong> (0.1-0.2)</span>
					</div>
					<div class="legend-item">
						<div class="legend-color" style="background: #f39c12"></div>
						<span><strong>–°—Ä–µ–¥–Ω–∏–π</strong> (0.2-0.3)</span>
					</div>
					<div class="legend-item">
						<div class="legend-color" style="background: #e74c3c"></div>
						<span><strong>–í—ã—Å–æ–∫–∏–π</strong> (‚â• 0.3)</span>
					</div>
				</div>
			</div>
		</div>

		<!-- –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã API -->
		<script src="https://api-maps.yandex.ru/2.1/?apikey=8a08b8a3-085d-4758-8055-6078a03bf83f&lang=ru_RU"></script>

		<script>
			// ‚ö†Ô∏è –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ '–í–ê–®_API_–ö–õ–Æ–ß' –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π API –∫–ª—é—á –∏–∑ –Ø–Ω–¥–µ–∫—Å.–ö–∞–±–∏–Ω–µ—Ç–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞!
			// –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á: https://developer.tech.yandex.ru/

			let map, hotspotsCollection, routeMultiRoute, clusterer
			let accidentsData = []
			let hotspotsData = []
			let hotspotsLoaded = false // –§–ª–∞–≥ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–æ–Ω (–∑–∞–≥—Ä—É–∂–∞–µ–º –æ–¥–∏–Ω —Ä–∞–∑)
			let selectedZone = null // –í—ã–±—Ä–∞–Ω–Ω–∞—è –∑–æ–Ω–∞ –¥–ª—è –ø–æ–∫–∞–∑–∞ –î–¢–ü
			let isLoading = false // –§–ª–∞–≥ –∑–∞–≥—Ä—É–∑–∫–∏ (–±–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
			let isAnalyzing = false // –§–ª–∞–≥ –∞–Ω–∞–ª–∏–∑–∞ –º–∞—Ä—à—Ä—É—Ç–∞ (–±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫)

			// ‚ö†Ô∏è –§–ò–ö–°–ò–†–û–í–ê–ù–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´ –î–õ–Ø –†–ê–°–ß–Å–¢–û–í (–Ω–µ –º–µ–Ω—è—é—Ç—Å—è!)
			const FIXED_GRID_SIZE = 1000 // –†–∞–∑–º–µ—Ä —Å–µ—Ç–∫–∏ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω (–º–µ—Ç—Ä—ã)
			const BASE_RADIUS = 500 // –ë–∞–∑–æ–≤—ã–π —Ä–∞–¥–∏—É—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π (–º–µ—Ç—Ä—ã)
			// –≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¢–û–õ–¨–ö–û –¥–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤, –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç UI

			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
			ymaps.ready(function () {
				// –û—á–∏—â–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
				const routeFromInput = document.getElementById('routeFrom')
				const routeToInput = document.getElementById('routeTo')
				if (routeFromInput) {
					routeFromInput.value = ''
					routeFromInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è'
				}
				if (routeToInput) {
					routeToInput.value = ''
					routeToInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è'
				}

				// –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∫–ª—é—á–∞
				const apiKey = document
					.querySelector('script[src*="api-maps.yandex.ru"]')
					?.src.match(/apikey=([^&\s]+)/)?.[1]

				if (!apiKey || apiKey === '–í–ê–®_API_–ö–õ–Æ–ß') {
					console.warn(
						'‚ö†Ô∏è API –∫–ª—é—á –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω! –ó–∞–º–µ–Ω–∏—Ç–µ –í–ê–®_API_–ö–õ–Æ–ß –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –∫–ª—é—á –≤ —Å—Ç—Ä–æ–∫–µ 491 index.html'
					)
					alert(
						'‚ö†Ô∏è API –∫–ª—é—á –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!\n\n–ó–∞–º–µ–Ω–∏—Ç–µ –í–ê–®_API_–ö–õ–Æ–ß –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –∫–ª—é—á –∏–∑ –∫–∞–±–∏–Ω–µ—Ç–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:\nhttps://developer.tech.yandex.ru/\n\n–ë–µ–∑ –∫–ª—é—á–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å.'
					)
				} else {
					console.log('‚úÖ API –∫–ª—é—á –Ω–∞–π–¥–µ–Ω:', apiKey.substring(0, 8) + '...')
				}

				// –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
				try {
					map = new ymaps.Map('map', {
						center: [55.7558, 37.6173], // –ú–æ—Å–∫–≤–∞
						zoom: 11,
					controls: [
						'zoomControl',
						'fullscreenControl',
						'geolocationControl',
					],
					})

					// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∫–∞—Ä—Ç—ã
					map.events.add('error', function (e) {
						console.error('‚ùå –û—à–∏–±–∫–∞ –∫–∞—Ä—Ç—ã:', e)
						const errorMessage = e.get('errorMessage') || ''
						if (
							errorMessage.includes('Invalid API key') ||
							errorMessage.includes('API key')
						) {
							alert(
								'‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å API –∫–ª—é—á–æ–º!\n\n' +
									'–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:\n' +
									'1. –ö–ª—é—á –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –≤ –∫–∞–±–∏–Ω–µ—Ç–µ (–∞–∫—Ç–∏–≤–∞—Ü–∏—è –¥–æ 15 –º–∏–Ω—É—Ç)\n' +
									'2. –î–æ–º–µ–Ω localhost –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã\n' +
									'3. –í–∫–ª—é—á–µ–Ω—ã —Å–µ—Ä–≤–∏—Å—ã: JavaScript API, –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, –ì–µ–æ–∫–æ–¥–µ—Ä\n\n' +
									'–ö–∞–±–∏–Ω–µ—Ç: https://developer.tech.yandex.ru/'
							)
						}
					})

					// –ü–∞–Ω–µ–ª—å –º–∞—Ä—à—Ä—É—Ç–æ–≤ routePanelControl —É–±—Ä–∞–Ω–∞ –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

					// –ö–æ–ª–ª–µ–∫—Ü–∏—è –¥–ª—è –æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω
					hotspotsCollection = new ymaps.GeoObjectCollection()

					// –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ç–æ—Ä –¥–ª—è —Ç–æ—á–µ–∫ –î–¢–ü
					clusterer = new ymaps.Clusterer({
						preset: 'islands#invertedVioletClusterIcons',
						groupByCoordinates: false,
						clusterDisableClickZoom: true,
						clusterHideIconOnBalloonOpen: false,
						geoObjectHideIconOnBalloonOpen: false,
						clusterBalloonContentLayout: 'cluster#balloonCarousel',
						clusterBalloonItemContentLayout: 'cluster#balloonCarouselItem',
						clusterBalloonPanelContentLayout: 'cluster#balloonCarousel',
						clusterOpenBalloonOnClick: true,
					})

					map.geoObjects.add(hotspotsCollection)
					map.geoObjects.add(clusterer)

					// –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–æ–Ω—ã –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
					loadHotspotsOnce()

					// –ó–∞–≥—Ä—É–∑–∫–∞ –î–¢–ü —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∑–æ–Ω—É
					let loadTimeout = null
					let lastBounds = null
					const debouncedLoadAccidents = function () {
						if (isLoading) {
							console.log('‚è∏Ô∏è –ó–∞–≥—Ä—É–∑–∫–∞ —É–∂–µ –∏–¥–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ–±—ã—Ç–∏–µ')
							return // –ë–ª–æ–∫–∏—Ä—É–µ–º, –µ—Å–ª–∏ –∏–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞
						}

						try {
							// –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ä—Ç—ã
							const bounds = map.getBounds()
							const boundsStr = JSON.stringify(bounds)

							// –ï—Å–ª–∏ –≥—Ä–∞–Ω–∏—Ü—ã –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
							if (lastBounds === boundsStr) {
								return
							}
							lastBounds = boundsStr

							// –ï—Å–ª–∏ –µ—Å—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–∞—è –∑–æ–Ω–∞, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –î–¢–ü –¥–ª—è –Ω–µ—ë –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–∞—Ä—Ç—ã
							if (selectedZone) {
								if (loadTimeout) {
									clearTimeout(loadTimeout)
								}
								loadTimeout = setTimeout(() => {
									if (!isLoading) {
										loadAccidentsForZone(selectedZone)
									}
								}, 500) // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –¥–æ 500–º—Å
								return
							}

							// –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –î–¢–ü –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
							// –û–Ω–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∑–æ–Ω—É
						} catch (error) {
							console.error('‚ùå –û—à–∏–±–∫–∞ –≤ debouncedLoadAccidents:', error)
						}
					}

					map.events.add('boundschange', debouncedLoadAccidents)
					map.events.add('zoomchange', debouncedLoadAccidents)
				} catch (error) {
					console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã:', error)
					alert(
						'‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É!\n\n' +
							'–û—à–∏–±–∫–∞: ' +
							error.message +
							'\n\n' +
							'–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:\n' +
							'1. API –∫–ª—é—á –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω\n' +
							'2. –î–æ–º–µ–Ω localhost –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ\n' +
							'3. –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π'
					)
					return
				}

				// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
				// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞ —É–¥–∞–ª–µ–Ω (—Ñ–æ—Ä–º–∞ period —É–±—Ä–∞–Ω–∞)

				// ‚ö†Ô∏è –í–ê–ñ–ù–û: gridSize –≤ UI –≤–ª–∏—è–µ—Ç –Ω–∞ –ü–ï–†–ï–°–ß–ï–¢ –∑–æ–Ω (–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é —Å–µ—Ç–∫–∏)!
				// –ü—Ä–∏ —É–º–µ–Ω—å—à–µ–Ω–∏–∏ gridSize —Å–µ—Ç–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º–µ–ª—å—á–µ ‚Üí –±–æ–ª—å—à–µ –∑–æ–Ω ‚Üí –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∞
				// –î–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è BASE_RADIUS = 500 –º (–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç gridSize)
				document
					.getElementById('gridSize')
					.addEventListener('change', function () {
						const newGridSize = parseInt(this.value) || 1000
						
						console.log(
							`üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Å–µ—Ç–∫–∏: ${newGridSize}–º ‚Üí –ø–µ—Ä–µ—Å—á–µ—Ç –æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω`
						)
						console.log(
							'‚ÑπÔ∏è –ú–µ–Ω—å—à–∏–π gridSize = –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å–µ—Ç–∫–∞ = –±–æ–ª—å—à–µ –∑–æ–Ω. –î–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è BASE_RADIUS=500–º'
						)
						
						// –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∑–æ–Ω—ã —Å –Ω–æ–≤—ã–º gridSize
						hotspotsLoaded = false
						hotspotsData = [] // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
						selectedZone = null // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∑–æ–Ω—É
						clusterer.removeAll() // –û—á–∏—â–∞–µ–º –î–¢–ü
						
						// –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∑–æ–Ω—ã —Å –Ω–æ–≤—ã–º gridSize
						loadHotspotsOnce()
					})
			})

			// –ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
			async function loadHotspotsOnce() {
				if (hotspotsLoaded || isLoading) {
					console.log('‚ö†Ô∏è –ó–æ–Ω—ã —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–ª–∏ –∏–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º')
					return
				}

				// –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∫–∞—Ä—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
				if (!map || !hotspotsCollection) {
					console.warn('‚ö†Ô∏è –ö–∞—Ä—Ç–∞ –∏–ª–∏ –∫–æ–ª–ª–µ–∫—Ü–∏—è –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã, –∂–¥–µ–º...')
					setTimeout(loadHotspotsOnce, 500)
					return
				}

				isLoading = true
				const loading = document.getElementById('loading')
				if (loading) {
					loading.classList.add('active')
					loading.querySelector('.loading-text').textContent =
						'–ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω...'
				}

				try {
					// –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–æ–Ω—ã –¥–ª—è –≤—Å–µ–π –ú–æ—Å–∫–≤—ã (–±–æ–ª—å—à–æ–π bbox)
					const bbox = '37.0,55.5,38.0,56.0' // –í–µ—Å—å —Ä–µ–≥–∏–æ–Ω –ú–æ—Å–∫–≤—ã
					const period = 'all' // –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ (—Ñ–æ—Ä–º–∞ –ø–µ—Ä–∏–æ–¥–∞ —É–±—Ä–∞–Ω–∞)
					const threshold = 5 // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä–æ–≥
					// ‚ö†Ô∏è –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º gridSize –∏–∑ UI –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –∑–æ–Ω (–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∫–∏)
					// –ù–æ –¥–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è BASE_RADIUS = 500 –º
					const gridSizeInput = document.getElementById('gridSize')
					const gridSize = gridSizeInput ? parseInt(gridSizeInput.value) || 1000 : 1000

					const requestStartTime = performance.now()
					console.log('üì° –ó–∞–ø—Ä–æ—Å –æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω (gridSize –∏–∑ UI):', {
						bbox,
						period,
						threshold,
						gridSize,
					})

					const response = await fetch(
						`api/hotspots.php?bbox=${encodeURIComponent(bbox)}&period=${period}&threshold=${threshold}&grid=${gridSize}`
					)

					// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ—Ç–≤–µ—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ JSON
					const contentType = response.headers.get('content-type')
					if (!contentType || !contentType.includes('application/json')) {
						const errorText = await response.text()
						console.error('‚ùå –û—Ç–≤–µ—Ç –Ω–µ JSON:', errorText.substring(0, 500))
						throw new Error(
							`–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ JSON. HTTP ${response.status}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ PHP.`
						)
					}

					if (!response.ok) {
						const errorData = await response
							.json()
							.catch(() => ({ error: 'Unknown error' }))
						throw new Error(
							`HTTP ${response.status}: ${errorData.error || 'Unknown error'}`
						)
					}

					const data = await response.json()
					const features = data.features || []
					const requestTime = (
						(performance.now() - requestStartTime) /
						1000
					).toFixed(2)
					const cacheStatus = response.headers.get('X-Cache') || 'UNKNOWN'

					console.log(
						'‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω:',
						features.length,
						features.length > 0
							? '(–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ –≤—Å–µ–≥–æ —Ñ–∞–π–ª–∞)'
							: '(–¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç)',
						`| –í—Ä–µ–º—è: ${requestTime}—Å | –ö—ç—à: ${cacheStatus}`
					)

					// –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∑–æ–Ω—ã
					try {
						if (map.geoObjects && hotspotsCollection) {
							map.geoObjects.remove(hotspotsCollection)
							hotspotsCollection.removeAll()
						}
					} catch (e) {
						console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —Å—Ç–∞—Ä—ã—Ö –∑–æ–Ω:', e)
					}

					if (features.length > 0) {
						let circlesCreated = 0
						features.forEach(feature => {
							try {
								const coords = feature.geometry?.coordinates
								const props = feature.properties || {}

								if (!coords || coords.length < 2) {
									console.warn(
										'‚ö†Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–∞ –∑–æ–Ω–∞ —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏:',
										feature
									)
									return
								}

								const center = [coords[1], coords[0]] // [lat, lon] –¥–ª—è –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç
								// ‚ö†Ô∏è –í–ê–ñ–ù–û: visualRadius –±–µ—Ä–µ—Ç—Å—è –∏–∑ API (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç gridSize –∑–∞–ø—Ä–æ—Å–∞)
								// –ù–æ –¥–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è BASE_RADIUS = 500 –º
								const visualRadius = props.radius || 400 // —Ä–∞–¥–∏—É—Å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–∏–∑ API, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç gridSize)
								const baseRadius = BASE_RADIUS // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–¥–∏—É—Å –¥–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤ (500 –º) - –ù–ï –º–µ–Ω—è–µ—Ç—Å—è!

								const colors = {
									low: '#fff9c4', // –ë–ª–µ–¥–Ω–æ-–∂–µ–ª—Ç—ã–π - –Ω–∏–∑–∫–∞—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å
									medium: '#f39c12', // –û—Ä–∞–Ω–∂–µ–≤—ã–π - —Å—Ä–µ–¥–Ω—è—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å
									high: '#e74c3c', // –ö—Ä–∞—Å–Ω—ã–π - –≤—ã—Å–æ–∫–∞—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å
								}

								const riskLevel = props.risk_level || 'medium'
								const count = props.count || 0

								// –í—ã—á–∏—Å–ª—è–µ–º bbox –∑–æ–Ω—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
								const zoneBbox = props.bbox || {
									minLat: center[0] - baseRadius / 111000, // –ü—Ä–∏–º–µ—Ä–Ω–æ 1 –≥—Ä–∞–¥—É—Å = 111 –∫–º
									maxLat: center[0] + baseRadius / 111000,
									minLon:
										center[1] -
										baseRadius /
											(111000 * Math.cos((center[0] * Math.PI) / 180)),
									maxLon:
										center[1] +
										baseRadius /
											(111000 * Math.cos((center[0] * Math.PI) / 180)),
								}

								// –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–æ–Ω—É –≤ hotspotsData —Å baseRadius –¥–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤
								// ‚ö†Ô∏è –í–ê–ñ–ù–û: baseRadius –≤—Å–µ–≥–¥–∞ 500 –º, –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–¥–∏—É—Å–∞!
								hotspotsData.push({
									center: center, // [lat, lon]
									baseRadius: baseRadius, // –î–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤ –≤—Å–µ–≥–¥–∞ 500 –º (BASE_RADIUS)
									visualRadius: visualRadius, // –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)
									riskLevel: riskLevel,
									count: count,
									severeCount: props.severe_count || 0, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
									density: props.density_per_1000m2 || 0,
									bbox: zoneBbox,
								})

								// –°–æ–∑–¥–∞–µ–º –∫—Ä—É–≥–ª—É—é –∑–æ–Ω—É (–∏—Å–ø–æ–ª—å–∑—É–µ–º visualRadius –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)
								const circle = new ymaps.Circle(
									[center, visualRadius], // [—Ü–µ–Ω—Ç—Ä, —Ä–∞–¥–∏—É—Å –≤ –º–µ—Ç—Ä–∞—Ö] - –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–∞–¥–∏—É—Å
									{
										balloonContentHeader: '–û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞',
										balloonContentBody: `
										<strong>–î–¢–ü:</strong> ${count}<br>
										<strong>–¢—è–∂–µ–ª—ã—Ö:</strong> ${props.severe_count || 0}<br>
										<strong>–ü–ª–æ—Ç–Ω–æ—Å—Ç—å:</strong> ${props.density_per_1000m2 ? props.density_per_1000m2.toFixed(4) : 'N/A'} –Ω–∞ 1000 –º¬≤<br>
										<strong>–£—Ä–æ–≤–µ–Ω—å:</strong> ${riskLevel}<br>
										<br>
										<em>–ö–ª–∏–∫–Ω–∏—Ç–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –î–¢–ü –≤ —ç—Ç–æ–π –∑–æ–Ω–µ</em>
									`,
										hintContent: `–û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞: ${count} –î–¢–ü`,
									},
									{
										fillColor: colors[riskLevel] || '#95a5a6',
										fillOpacity: riskLevel === 'low' ? 0.5 : 0.3,
										strokeColor: '#fff',
										strokeWidth: 2,
										strokeOpacity: 0.8,
									}
								)

								// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∑–æ–Ω—É
								circle.events.add('click', function (e) {
									e.stopPropagation() // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ —Å–æ–±—ã—Ç–∏—è
									loadAccidentsForZone(props)
								})

								hotspotsCollection.add(circle)
								circlesCreated++
							} catch (e) {
								console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫—Ä—É–≥–∞:', e, feature)
							}
						})

						console.log(
							`‚úÖ –°–æ–∑–¥–∞–Ω–æ –∫—Ä—É–≥–æ–≤: ${circlesCreated} –∏–∑ ${features.length}`
						)

						// –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–ª–µ–∫—Ü–∏—é –Ω–∞ –∫–∞—Ä—Ç—É
						if (circlesCreated > 0) {
							map.geoObjects.add(hotspotsCollection)
							console.log('‚úÖ –ö–æ–ª–ª–µ–∫—Ü–∏—è –∑–æ–Ω –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞ –∫–∞—Ä—Ç—É')
						}

						hotspotsLoaded = true
						const countEl = document.getElementById('hotspotsCount')
						if (countEl) {
							countEl.textContent = circlesCreated
						}
					} else {
						console.warn('‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∑–æ–Ω–∞—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è')
						const countEl = document.getElementById('hotspotsCount')
						if (countEl) {
							countEl.textContent = '0'
						}
					}
				} catch (error) {
					console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω:', error)
					alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω: ' + error.message)
				} finally {
					isLoading = false
					if (loading) {
						loading.classList.remove('active')
						loading.querySelector('.loading-text').textContent =
							'–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...'
					}
				}
			}

			// –ó–∞–≥—Ä—É–∑–∫–∞ –î–¢–ü –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∑–æ–Ω—ã
			async function loadAccidentsForZone(zoneProps) {
				if (isLoading) {
					console.log('‚ö†Ô∏è –£–∂–µ –∏–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º')
					return
				}

				// –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∑–æ–Ω—É
				selectedZone = zoneProps

				isLoading = true
				const loading = document.getElementById('loading')
				if (loading) {
					loading.classList.add('active')
					loading.querySelector('.loading-text').textContent =
						'–ó–∞–≥—Ä—É–∑–∫–∞ –î–¢–ü –≤ –∑–æ–Ω–µ...'
				}

				try {
					// –ò—Å–ø–æ–ª—å–∑—É–µ–º bbox –∑–æ–Ω—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –î–¢–ü
					const bbox = zoneProps.bbox
					const bboxStr = `${bbox.minLon},${bbox.minLat},${bbox.maxLon},${bbox.maxLat}`

					const response = await fetch(
						`api/accidents.php?bbox=${encodeURIComponent(bboxStr)}&limit=1000`
					)
					if (!response.ok) throw new Error(`HTTP ${response.status}`)

					const data = await response.json()
					const features = data.features || []

					console.log('‚úÖ –î–¢–ü –≤ –∑–æ–Ω–µ:', features.length)

					// –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –º–∞—Ä–∫–µ—Ä—ã
					clusterer.removeAll()

					if (features.length > 0) {
						const placemarks = []

						features.forEach(feature => {
							const coords = feature.geometry.coordinates
							const props = feature.properties

							const placemark = new ymaps.Placemark(
								[coords[1], coords[0]],
								{
									balloonContentHeader: '–î–¢–ü',
									balloonContentBody: `
			                                 <strong>–î–∞—Ç–∞:</strong> ${props.dt || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}<br>
			                                 <strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${props.category || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}<br>
			                                 <strong>–¢—è–∂–µ—Å—Ç—å:</strong> ${props.severity || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}<br>
			                                 <strong>–ê–¥—Ä–µ—Å:</strong> ${props.address || '–ù–µ —É–∫–∞–∑–∞–Ω'}
			                             `,
								},
								{
									preset: 'islands#redCircleDotIcon',
									iconColor: '#e74c3c',
								}
							)

							placemarks.push(placemark)
						})

						// –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ç–æ—Ä
						clusterer.add(placemarks)
					}
				} catch (error) {
					console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –î–¢–ü –¥–ª—è –∑–æ–Ω—ã:', error)
					alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –î–¢–ü: ' + error.message)
				} finally {
					isLoading = false
					if (loading) {
						loading.classList.remove('active')
						loading.querySelector('.loading-text').textContent =
							'–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...'
					}
				}
			}

			// –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –î–¢–ü (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∑–æ–Ω—É)
			async function loadAccidents() {
				if (!map || isLoading) return

				const zoom = map.getZoom()

				// –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –î–¢–ü
				// –û–Ω–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∑–æ–Ω—É —á–µ—Ä–µ–∑ loadAccidentsForZone
				if (zoom < 13) {
					clusterer.removeAll()
					return
				}

				isLoading = true
				const loading = document.getElementById('loading')
				if (loading) {
					loading.classList.add('active')
					loading.querySelector('.loading-text').textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –î–¢–ü...'
				}

				const bounds = map.getBounds()
				const bbox = `${bounds[0][1]},${bounds[0][0]},${bounds[1][1]},${bounds[1][0]}`
				const maxPoints = zoom < 14 ? 1000 : 2000

				try {
					const response = await fetch(
						`api/accidents.php?bbox=${encodeURIComponent(bbox)}&limit=${maxPoints}`
					)
					if (!response.ok) throw new Error(`HTTP ${response.status}`)

					const data = await response.json()
					const features = data.features || []

					console.log('‚úÖ –î–¢–ü –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:', features.length)

					clusterer.removeAll()

					if (features.length > 0) {
						const placemarks = []

						features.forEach(feature => {
							const coords = feature.geometry.coordinates
							const props = feature.properties

							const placemark = new ymaps.Placemark(
								[coords[1], coords[0]],
								{
									balloonContentHeader: '–î–¢–ü',
									balloonContentBody: `
			                                 <strong>–î–∞—Ç–∞:</strong> ${props.dt || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}<br>
			                                 <strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${props.category || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}<br>
			                                 <strong>–¢—è–∂–µ—Å—Ç—å:</strong> ${props.severity || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}<br>
			                                 <strong>–ê–¥—Ä–µ—Å:</strong> ${props.address || '–ù–µ —É–∫–∞–∑–∞–Ω'}
			                             `,
								},
								{
									preset: 'islands#redCircleDotIcon',
									iconColor: '#e74c3c',
								}
							)

							placemarks.push(placemark)
						})

						// –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ç–æ—Ä
						clusterer.add(placemarks)
					}
				} catch (error) {
					console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –î–¢–ü:', error)
					alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –î–¢–ü: ' + error.message)
				} finally {
					isLoading = false
					if (loading) {
						loading.classList.remove('active')
						loading.querySelector('.loading-text').textContent =
							'–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...'
					}
				}
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
			function loadData() {
				if (isLoading) {
					console.log('‚ö†Ô∏è –£–∂–µ –∏–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º')
					return
				}
				hotspotsLoaded = false
				selectedZone = null // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∑–æ–Ω—É
				clusterer.removeAll()
				loadHotspotsOnce()
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ –∫—ç—à–∞ –¥–∞–Ω–Ω—ã—Ö
			async function resetCache() {
				if (
					!confirm(
						'–°–±—Ä–æ—Å–∏—Ç—å –∫—ç—à –¥–∞–Ω–Ω—ã—Ö? –≠—Ç–æ –∑–∞—Å—Ç–∞–≤–∏—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞.'
					)
				) {
					return
				}

				try {
					// –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫—ç—à —á–µ—Ä–µ–∑ API
					const response = await fetch(
						'api/hotspots.php?bbox=37.0,55.5,38.0,56.0&period=all&threshold=5&grid=1000&reset_cache=1'
					)
					if (!response.ok) throw new Error(`HTTP ${response.status}`)

					console.log('‚úÖ –ö—ç—à —Å–±—Ä–æ—à–µ–Ω, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ...')
					hotspotsLoaded = false
					loadHotspotsOnce()
				} catch (error) {
					console.error('–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –∫—ç—à–∞:', error)
					alert('–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –∫—ç—à–∞: ' + error.message)
				}
			}

			// ============================================
			// –§–£–ù–ö–¶–ò–ò –ê–ù–ê–õ–ò–ó–ê –û–ü–ê–°–ù–û–°–¢–ò –ú–ê–†–®–†–£–¢–û–í
			// ============================================

			/**
			 * –í—ã—á–∏—Å–ª—è–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–æ—á–∫–∞–º–∏ –Ω–∞ –ó–µ–º–ª–µ (–≤ –º–µ—Ç—Ä–∞—Ö) - —Ñ–æ—Ä–º—É–ª–∞ Haversine
			 */
			function distance(lat1, lon1, lat2, lon2) {
				const R = 6371000 // –†–∞–¥–∏—É—Å –ó–µ–º–ª–∏ –≤ –º–µ—Ç—Ä–∞—Ö
				const dLat = ((lat2 - lat1) * Math.PI) / 180
				const dLon = ((lon2 - lon1) * Math.PI) / 180
				const a =
					Math.sin(dLat / 2) * Math.sin(dLat / 2) +
					Math.cos((lat1 * Math.PI) / 180) *
						Math.cos((lat2 * Math.PI) / 180) *
						Math.sin(dLon / 2) *
						Math.sin(dLon / 2)
				const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))
				return R * c // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –º–µ—Ç—Ä–∞—Ö
			}

			/**
			 * –ü–æ–ª—É—á–∞–µ—Ç bbox (–≥—Ä–∞–Ω–∏—Ü—ã) –º–∞—Ä—à—Ä—É—Ç–∞
			 */
			function getRouteBbox(coordinates) {
				if (!coordinates || coordinates.length === 0) {
					console.warn('‚ö†Ô∏è –ù–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è bbox')
					return { minLat: 0, maxLat: 0, minLon: 0, maxLon: 0 }
				}

				let minLat = Infinity,
					maxLat = -Infinity
				let minLon = Infinity,
					maxLon = -Infinity

				for (let coord of coordinates) {
					if (!Array.isArray(coord) || coord.length < 2) {
						console.warn('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:', coord)
						continue
					}

					const [lat, lon] = coord

					// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
					if (typeof lat !== 'number' || typeof lon !== 'number') {
						console.warn('‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ —á–∏—Å–ª–∞:', coord)
						continue
					}

					// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ä–∞–∑—É–º–Ω—ã—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö (–¥–ª—è –ú–æ—Å–∫–≤—ã)
					if (lat < 50 || lat > 60 || lon < 30 || lon > 40) {
						console.warn(
							`‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–Ω–µ —Ä–∞–∑—É–º–Ω—ã—Ö –ø—Ä–µ–¥–µ–ª–æ–≤: [${lat}, ${lon}]`
						)
						// –í–æ–∑–º–æ–∂–Ω–æ, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ [lon, lat], –ø—Ä–æ–±—É–µ–º –ø–æ–º–µ–Ω—è—Ç—å –º–µ—Å—Ç–∞–º–∏
						const [maybeLon, maybeLat] = coord
						if (
							maybeLat >= 50 &&
							maybeLat <= 60 &&
							maybeLon >= 30 &&
							maybeLon <= 40
						) {
							console.log(
								`üîÑ –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º–∞—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç: [${lat}, ${lon}] -> [${maybeLat}, ${maybeLon}]`
							)
							minLat = Math.min(minLat, maybeLat)
							maxLat = Math.max(maxLat, maybeLat)
							minLon = Math.min(minLon, maybeLon)
							maxLon = Math.max(maxLon, maybeLon)
							continue
						}
					}

					minLat = Math.min(minLat, lat)
					maxLat = Math.max(maxLat, lat)
					minLon = Math.min(minLon, lon)
					maxLon = Math.max(maxLon, lon)
				}

				if (minLat === Infinity) {
					console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã—á–∏—Å–ª–∏—Ç—å bbox –º–∞—Ä—à—Ä—É—Ç–∞')
					return { minLat: 0, maxLat: 0, minLon: 0, maxLon: 0 }
				}

				return { minLat, maxLat, minLon, maxLon }
			}

			/**
			 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –¥–≤—É—Ö bbox
			 */
			function bboxesIntersect(bbox1, bbox2) {
				if (!bbox2) return true // –ï—Å–ª–∏ bbox –∑–æ–Ω—ã –Ω–µ —É–∫–∞–∑–∞–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ
				return !(
					bbox1.maxLat < bbox2.minLat ||
					bbox1.minLat > bbox2.maxLat ||
					bbox1.maxLon < bbox2.minLon ||
					bbox1.minLon > bbox2.maxLon
				)
			}

			/**
			 * –§–∏–ª—å—Ç—Ä—É–µ—Ç –∑–æ–Ω—ã –ø–æ bbox –º–∞—Ä—à—Ä—É—Ç–∞ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
			 */
			function getZonesNearRoute(routeCoordinates, allZones) {
				if (!routeCoordinates || routeCoordinates.length === 0) {
					console.warn('‚ö†Ô∏è –ù–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –º–∞—Ä—à—Ä—É—Ç–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∑–æ–Ω')
					return []
				}

				const routeBbox = getRouteBbox(routeCoordinates)
				console.log(`üîç Bbox –º–∞—Ä—à—Ä—É—Ç–∞:`, routeBbox)

				// –†–∞—Å—à–∏—Ä—è–µ–º bbox –º–∞—Ä—à—Ä—É—Ç–∞ —Å —É—á—ë—Ç–æ–º —Ä–∞–¥–∏—É—Å–∞ –∑–æ–Ω (500–º + –∑–∞–ø–∞—Å)
				const expandMeters = 1000 // 1 –∫–º –∑–∞–ø–∞—Å
				const latExpand = expandMeters / 111000 // –ø—Ä–∏–º–µ—Ä–Ω–æ 1 –≥—Ä–∞–¥—É—Å = 111 –∫–º
				const lonExpand =
					expandMeters /
					(111000 *
						Math.cos(
							(((routeBbox.minLat + routeBbox.maxLat) / 2) * Math.PI) / 180
						))

				const expandedBbox = {
					minLat: routeBbox.minLat - latExpand,
					maxLat: routeBbox.maxLat + latExpand,
					minLon: routeBbox.minLon - lonExpand,
					maxLon: routeBbox.maxLon + lonExpand,
				}

				console.log(`üîç –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π bbox –º–∞—Ä—à—Ä—É—Ç–∞:`, expandedBbox)

				const filteredZones = allZones.filter(zone => {
					if (!zone.center || zone.center.length < 2) {
						return false
					}

					const [zoneLat, zoneLon] = zone.center
					const zoneRadius = zone.baseRadius || BASE_RADIUS

					// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —Ü–µ–Ω—Ç—Ä –∑–æ–Ω—ã –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–º bbox
					const inBbox =
						zoneLat >= expandedBbox.minLat &&
						zoneLat <= expandedBbox.maxLat &&
						zoneLon >= expandedBbox.minLon &&
						zoneLon <= expandedBbox.maxLon

					if (inBbox) {
						return true
					}

					// –ï—Å–ª–∏ —Ü–µ–Ω—Ç—Ä –∑–æ–Ω—ã –≤–Ω–µ bbox, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –±–ª–∏–∂–∞–π—à–µ–π —Ç–æ—á–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞
					// –ù–∞—Ö–æ–¥–∏–º –±–ª–∏–∂–∞–π—à—É—é —Ç–æ—á–∫—É –º–∞—Ä—à—Ä—É—Ç–∞ –∫ —Ü–µ–Ω—Ç—Ä—É –∑–æ–Ω—ã
					let minDist = Infinity
					for (let [lat, lon] of routeCoordinates) {
						const dist = distance(lat, lon, zoneLat, zoneLon)
						if (dist < minDist) {
							minDist = dist
						}
					}

					// –ï—Å–ª–∏ –∑–æ–Ω–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–ª–∏–∑–∫–æ –∫ –º–∞—Ä—à—Ä—É—Ç—É (—Ä–∞–¥–∏—É—Å + –∑–∞–ø–∞—Å)
					return minDist <= zoneRadius + expandMeters
				})

				console.log(
					`üîç –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ –∑–æ–Ω: ${filteredZones.length} –∏–∑ ${allZones.length}`
				)
				if (filteredZones.length > 0) {
					console.log(
						`üîç –ü–µ—Ä–≤–∞—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–æ–Ω–∞: —Ü–µ–Ω—Ç—Ä [${filteredZones[0].center[0]?.toFixed(4)}, ${filteredZones[0].center[1]?.toFixed(4)}], —Ä–∞–¥–∏—É—Å ${filteredZones[0].baseRadius}–º`
					)
				}

				return filteredZones
			}

			/**
			 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø—Ä–æ—Ö–æ–¥–∏—Ç –ª–∏ –º–∞—Ä—à—Ä—É—Ç —á–µ—Ä–µ–∑ –æ–ø–∞—Å–Ω—É—é –∑–æ–Ω—É (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç baseRadius)
			 */
			function routePassesThroughZone(routeCoordinates, zone) {
				const [zoneLat, zoneLon] = zone.center
				const zoneRadius = zone.baseRadius // ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º baseRadius –¥–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤!

				// –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ –≤—Å–µ —Ç–æ—á–∫–∏, –∞ –∫–∞–∂–¥—É—é N-—é
				const step = Math.max(1, Math.floor(routeCoordinates.length / 100))

				for (let i = 0; i < routeCoordinates.length; i += step) {
					const [pointLat, pointLon] = routeCoordinates[i]
					const dist = distance(pointLat, pointLon, zoneLat, zoneLon)

					if (dist <= zoneRadius) {
						return true // –ú–∞—Ä—à—Ä—É—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –∑–æ–Ω—É
					}
				}

				return false
			}

			/**
			 * –í—ã—á–∏—Å–ª—è–µ—Ç –¥–ª–∏–Ω—É —É—á–∞—Å—Ç–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞ –≤–Ω—É—Ç—Ä–∏ –∑–æ–Ω—ã
			 * –£–ª—É—á—à–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ —Å–µ–≥–º–µ–Ω—Ç—ã –º–∞—Ä—à—Ä—É—Ç–∞
			 */
			function calculateLengthInZone(routeCoordinates, zone, debug = false) {
				const [zoneLat, zoneLon] = zone.center
				const zoneRadius = zone.baseRadius // ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º baseRadius (500 –º)!
				let lengthInZone = 0
				let segmentsInZone = 0
				let minDistToZone = Infinity

				if (debug) {
					console.log(
						`  üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–æ–Ω—ã: —Ü–µ–Ω—Ç—Ä [${zoneLat.toFixed(4)}, ${zoneLon.toFixed(4)}], —Ä–∞–¥–∏—É—Å ${zoneRadius}–º`
					)
					if (routeCoordinates.length > 0) {
						const firstPoint = routeCoordinates[0]
						console.log(
							`  üîç –ü–µ—Ä–≤–∞—è —Ç–æ—á–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞: [${firstPoint[0]?.toFixed(4)}, ${firstPoint[1]?.toFixed(4)}]`
						)
					}
				}

				// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π —Å–µ–≥–º–µ–Ω—Ç –º–∞—Ä—à—Ä—É—Ç–∞
				for (let i = 0; i < routeCoordinates.length - 1; i++) {
					let [lat1, lon1] = routeCoordinates[i]
					let [lat2, lon2] = routeCoordinates[i + 1]

					// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º–∞—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
					if (
						typeof lat1 !== 'number' ||
						typeof lon1 !== 'number' ||
						typeof lat2 !== 'number' ||
						typeof lon2 !== 'number'
					) {
						continue
					}

					// –ï—Å–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ [lon, lat] (–ø–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ > 90), –º–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏
					if (Math.abs(lat1) > 90) {
						;[lat1, lon1] = [lon1, lat1]
					}
					if (Math.abs(lat2) > 90) {
						;[lat2, lon2] = [lon2, lat2]
					}

					// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ä–∞–∑—É–º–Ω—ã—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö –¥–ª—è –ú–æ—Å–∫–≤—ã
					if (
						lat1 < 50 ||
						lat1 > 60 ||
						lon1 < 30 ||
						lon1 > 40 ||
						lat2 < 50 ||
						lat2 > 60 ||
						lon2 < 30 ||
						lon2 > 40
					) {
						if (debug && i < 3) {
							console.warn(
								`    ‚ö†Ô∏è –°–µ–≥–º–µ–Ω—Ç ${i}: –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–Ω–µ —Ä–∞–∑—É–º–Ω—ã—Ö –ø—Ä–µ–¥–µ–ª–æ–≤: [${lat1}, ${lon1}], [${lat2}, ${lon2}]`
							)
						}
						continue
					}

					const dist1 = distance(lat1, lon1, zoneLat, zoneLon)
					const dist2 = distance(lat2, lon2, zoneLat, zoneLon)
					const segmentLength = distance(lat1, lon1, lat2, lon2)

					// –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
					minDistToZone = Math.min(minDistToZone, dist1, dist2)

					if (debug && i < 5) {
						console.log(
							`    –°–µ–≥–º–µ–Ω—Ç ${i}: [${lat1.toFixed(4)}, ${lon1.toFixed(4)}] -> [${lat2.toFixed(4)}, ${lon2.toFixed(4)}], —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –¥–æ –∑–æ–Ω—ã: ${dist1.toFixed(0)}–º, ${dist2.toFixed(0)}–º`
						)
					}

					// –ï—Å–ª–∏ –æ–±–∞ –∫–æ–Ω—Ü–∞ —Å–µ–≥–º–µ–Ω—Ç–∞ –≤–Ω—É—Ç—Ä–∏ –∑–æ–Ω—ã - –≤–µ—Å—å —Å–µ–≥–º–µ–Ω—Ç –≤ –∑–æ–Ω–µ
					if (dist1 <= zoneRadius && dist2 <= zoneRadius) {
						lengthInZone += segmentLength
						segmentsInZone++
						if (debug) {
							console.log(
								`    ‚úÖ –°–µ–≥–º–µ–Ω—Ç ${i}: –æ–±–∞ –∫–æ–Ω—Ü–∞ –≤–Ω—É—Ç—Ä–∏ (${dist1.toFixed(0)}–º, ${dist2.toFixed(0)}–º)`
							)
						}
					}
					// –ï—Å–ª–∏ –æ–¥–∏–Ω –∫–æ–Ω–µ—Ü –≤–Ω—É—Ç—Ä–∏, –¥—Ä—É–≥–æ–π —Å–Ω–∞—Ä—É–∂–∏
					else if (dist1 <= zoneRadius || dist2 <= zoneRadius) {
						// –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á—ë—Ç: —Å—á–∏—Ç–∞–µ–º —á–∞—Å—Ç—å —Å–µ–≥–º–µ–Ω—Ç–∞ –≤–Ω—É—Ç—Ä–∏ –∑–æ–Ω—ã
						lengthInZone += segmentLength * 0.6 // –ü—Ä–∏–º–µ—Ä–Ω–∞—è –æ—Ü–µ–Ω–∫–∞
						segmentsInZone++
						if (debug) {
							console.log(
								`    ‚ö†Ô∏è –°–µ–≥–º–µ–Ω—Ç ${i}: –æ–¥–∏–Ω –∫–æ–Ω–µ—Ü –≤–Ω—É—Ç—Ä–∏ (${dist1.toFixed(0)}–º, ${dist2.toFixed(0)}–º)`
							)
						}
					}
					// –ï—Å–ª–∏ –æ–±–∞ –∫–æ–Ω—Ü–∞ —Å–Ω–∞—Ä—É–∂–∏, –Ω–æ —Å–µ–≥–º–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å –∑–æ–Ω—É
					else {
						// –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ –∑–æ–Ω—ã –¥–æ —Å–µ–≥–º–µ–Ω—Ç–∞
						const minDist = getMinDistanceToSegment(
							lat1,
							lon1,
							lat2,
							lon2,
							zoneLat,
							zoneLon
						)
						if (minDist <= zoneRadius) {
							// –°–µ–≥–º–µ–Ω—Ç –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç –∑–æ–Ω—É - –¥–æ–±–∞–≤–ª—è–µ–º —á–∞—Å—Ç—å –¥–ª–∏–Ω—ã
							// –ß–µ–º –±–ª–∏–∂–µ —Å–µ–≥–º–µ–Ω—Ç –∫ —Ü–µ–Ω—Ç—Ä—É –∑–æ–Ω—ã, —Ç–µ–º –±–æ–ª—å—à–µ —á–∞—Å—Ç—å
							const overlapRatio = 1 - minDist / zoneRadius
							lengthInZone += segmentLength * overlapRatio * 0.5
							segmentsInZone++
							if (debug) {
								console.log(
									`    ‚ö†Ô∏è –°–µ–≥–º–µ–Ω—Ç ${i}: –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç –∑–æ–Ω—É (–º–∏–Ω. —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ ${minDist.toFixed(0)}–º)`
								)
							}
						}
					}
				}

				if (debug && lengthInZone > 0) {
					console.log(
						`  ‚úÖ –ó–æ–Ω–∞ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è: –¥–ª–∏–Ω–∞ ${(lengthInZone / 1000).toFixed(3)} –∫–º, —Å–µ–≥–º–µ–Ω—Ç–æ–≤: ${segmentsInZone}, –º–∏–Ω. —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${minDistToZone.toFixed(0)}–º`
					)
				} else if (debug) {
					console.log(
						`  ‚ùå –ó–æ–Ω–∞ –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è: –º–∏–Ω. —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ ${minDistToZone.toFixed(0)}–º (—Ä–∞–¥–∏—É—Å –∑–æ–Ω—ã: ${zoneRadius}–º)`
					)
				}

				return lengthInZone
			}

			/**
			 * –í—ã—á–∏—Å–ª—è–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ç–æ—á–∫–∏ –¥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ –ª–∏–Ω–∏–∏
			 */
			function getMinDistanceToSegment(
				lat1,
				lon1,
				lat2,
				lon2,
				pointLat,
				pointLon
			) {
				// –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ç–æ—á–∫–∏ –¥–æ –±–ª–∏–∂–∞–π—à–µ–π —Ç–æ—á–∫–∏ –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç–µ
				const segLength = distance(lat1, lon1, lat2, lon2)
				if (segLength === 0) {
					return distance(lat1, lon1, pointLat, pointLon)
				}

				// –í—ã—á–∏—Å–ª—è–µ–º –ø—Ä–æ–µ–∫—Ü–∏—é —Ç–æ—á–∫–∏ –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç
				// –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–∫–∞–ª—è—Ä–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –±–ª–∏–∂–∞–π—à–µ–π —Ç–æ—á–∫–∏
				const dx = lat2 - lat1
				const dy = lon2 - lon1
				const px = pointLat - lat1
				const py = pointLon - lon1

				const t = Math.max(
					0,
					Math.min(1, (px * dx + py * dy) / (segLength * segLength))
				)
				const projLat = lat1 + t * dx
				const projLon = lon1 + t * dy

				return distance(pointLat, pointLon, projLat, projLon)
			}

			/**
			 * –í—ã—á–∏—Å–ª—è–µ—Ç –æ–±—â—É—é –¥–ª–∏–Ω—É –º–∞—Ä—à—Ä—É—Ç–∞
			 */
			function calculateRouteLength(coordinates) {
				let totalLength = 0
				for (let i = 0; i < coordinates.length - 1; i++) {
					const [lat1, lon1] = coordinates[i]
					const [lat2, lon2] = coordinates[i + 1]
					totalLength += distance(lat1, lon1, lat2, lon2)
				}
				return totalLength
			}

			/**
			 * –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –º–∞—Ä—à—Ä—É—Ç–∞
			 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç baseRadius –¥–ª—è –≤—Å–µ—Ö —Ä–∞—Å—á—ë—Ç–æ–≤, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–¥–∏—É—Å–∞
			 */
			function calculateRouteSafetyCombined(routeCoordinates, allZones) {
				const routeLength = calculateRouteLength(routeCoordinates)

				console.log(
					`üîç –ê–Ω–∞–ª–∏–∑ –º–∞—Ä—à—Ä—É—Ç–∞: ${routeCoordinates.length} —Ç–æ—á–µ–∫, –¥–ª–∏–Ω–∞ ${(routeLength / 1000).toFixed(2)} –∫–º`
				)
				console.log(`üîç –í—Å–µ–≥–æ –æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω: ${allZones.length}`)

				// –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–æ–Ω –ø–æ bbox (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
				const zonesNearRoute = getZonesNearRoute(routeCoordinates, allZones)
				console.log(
					`üîç –ó–æ–Ω —Ä—è–¥–æ–º —Å –º–∞—Ä—à—Ä—É—Ç–æ–º (–ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏): ${zonesNearRoute.length}`
				)

				let lowCount = 0,
					mediumCount = 0,
					highCount = 0
				let lowLength = 0,
					mediumLength = 0,
					highLength = 0
				let maxRiskLevel = 'safe'
				const zonesPassed = []

				for (let zone of zonesNearRoute) {
					const [zoneLat, zoneLon] = zone.center
					// –í–∫–ª—é—á–∞–µ–º –æ—Ç–ª–∞–¥–∫—É –¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∑–æ–Ω
					const debug = zonesPassed.length < 3
					const lengthInZone = calculateLengthInZone(
						routeCoordinates,
						zone,
						debug
					)

					if (lengthInZone > 0) {
						zonesPassed.push({
							zone: zone,
							length: lengthInZone,
						})

						console.log(
							`‚úÖ –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å –∑–æ–Ω–æ–π: ${zone.riskLevel}, –¥–ª–∏–Ω–∞ –≤ –∑–æ–Ω–µ: ${(lengthInZone / 1000).toFixed(3)} –∫–º, —Ü–µ–Ω—Ç—Ä: [${zoneLat.toFixed(4)}, ${zoneLon.toFixed(4)}], —Ä–∞–¥–∏—É—Å: ${zone.baseRadius}–º`
						)

						if (zone.riskLevel === 'low') {
							lowCount++
							lowLength += lengthInZone
						} else if (zone.riskLevel === 'medium') {
							mediumCount++
							mediumLength += lengthInZone
							if (maxRiskLevel === 'safe' || maxRiskLevel === 'low') {
								maxRiskLevel = 'medium'
							}
						} else if (zone.riskLevel === 'high') {
							highCount++
							highLength += lengthInZone
							maxRiskLevel = 'high'
						}
					} else if (debug) {
						console.log(
							`‚ùå –ù–µ—Ç –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Å –∑–æ–Ω–æ–π: ${zone.riskLevel}, —Ü–µ–Ω—Ç—Ä: [${zoneLat.toFixed(4)}, ${zoneLon.toFixed(4)}], —Ä–∞–¥–∏—É—Å: ${zone.baseRadius}–º`
						)
					}
				}

				console.log(
					`üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞: ${zonesPassed.length} –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π (${lowCount} –Ω–∏–∑–∫–∏—Ö, ${mediumCount} —Å—Ä–µ–¥–Ω–∏—Ö, ${highCount} –≤—ã—Å–æ–∫–∏—Ö)`
				)

				// –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞
				const countScore = lowCount * 1 + mediumCount * 2 + highCount * 3
				const lengthScore =
					(lowLength * 1 + mediumLength * 2 + highLength * 3) / 1000 // –≤ –∫–º
				const safetyScore = countScore * 0.4 + lengthScore * 0.6 // –í–µ—Å–∞: 40% –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, 60% –¥–ª–∏–Ω–∞

				// –ü—Ä–æ—Ü–µ–Ω—Ç –æ–ø–∞—Å–Ω–æ–≥–æ –ø—É—Ç–∏
				const dangerousPercentage =
					routeLength > 0
						? ((lowLength + mediumLength + highLength) / routeLength) * 100
						: 0

				return {
					totalZones: zonesPassed.length,
					lowCount,
					mediumCount,
					highCount,
					lowLength,
					mediumLength,
					highLength,
					maxRiskLevel,
					safetyScore,
					dangerousPercentage,
					routeLength,
					zones: zonesPassed,
				}
			}

			// ============================================
			// –ü–û–°–¢–†–û–ï–ù–ò–ï –ò –ê–ù–ê–õ–ò–ó –ú–ê–†–®–†–£–¢–û–í
			// ============================================

			/**
			 * –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã –∏–∑ routePanelControl (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
			 */
			function analyzeRouteFromPanel(routePanelControl) {
				// –î–ª—è routePanelControl –æ–±—ã—á–Ω–æ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –º–∞—Ä—à—Ä—É—Ç
				// –î–ª—è –ø–æ–ª–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MultiRoute
				console.log(
					'‚ÑπÔ∏è –î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –º–∞—Ä—à—Ä—É—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ MultiRoute API'
				)
			}

			/**
			 * –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã –∏–∑ MultiRoute –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
			 * @returns {Promise<void>}
			 */
			async function analyzeRoutes() {
				console.log('üîç –§—É–Ω–∫—Ü–∏—è analyzeRoutes() –≤—ã–∑–≤–∞–Ω–∞')
				console.log('üîç routeMultiRoute:', routeMultiRoute ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç')
				console.log('üîç hotspotsData:', hotspotsData ? `${hotspotsData.length} –∑–æ–Ω` : '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç')
				
				if (!routeMultiRoute || !hotspotsData || hotspotsData.length === 0) {
					console.warn('‚ö†Ô∏è –ù–µ—Ç –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏–ª–∏ –æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞')
					const loading = document.getElementById('loading')
					if (loading) loading.classList.remove('active')
					return
				}

				const routes = routeMultiRoute.getRoutes()
				console.log('üîç –ü–æ–ª—É—á–µ–Ω–æ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏–∑ routeMultiRoute:', routes ? routes.length : 0)
				
				if (!routes || routes.length === 0) {
					console.warn('‚ö†Ô∏è –ù–µ—Ç –º–∞—Ä—à—Ä—É—Ç–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞')
					const loading = document.getElementById('loading')
					if (loading) loading.classList.remove('active')
					return
				}

				const results = []
				console.log('üîç –ù–∞—á–∏–Ω–∞–µ–º –∞–Ω–∞–ª–∏–∑', routes.length, '–º–∞—Ä—à—Ä—É—Ç–æ–≤...')

				// –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π –º–∞—Ä—à—Ä—É—Ç
				routes.each(function (route, index) {
					try {
						// –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥ —á–µ—Ä–µ–∑ –ø—É—Ç–∏ –∏ —Å–µ–≥–º–µ–Ω—Ç—ã (—Ä–∞–±–æ—Ç–∞—é—â–∏–π —Å–ø–æ—Å–æ–±)
						const routeResult = getRouteCoordinatesFromPaths(route, index)

						if (routeResult) {
							results.push(routeResult)
						}
					} catch (error) {
						console.error(`‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –º–∞—Ä—à—Ä—É—Ç–∞ ${index + 1}:`, error)
					}
				})

				// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
				console.log('üîç –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω. –ü–æ–ª—É—á–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', results.length)
				
				if (results.length === 0) {
					console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∏ –æ–¥–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞')
					const loading = document.getElementById('loading')
					if (loading) loading.classList.remove('active')
					return
				}

				// –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
				results.sort((a, b) => a.safety.safetyScore - b.safety.safetyScore)
				console.log('üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –õ—É—á—à–∏–π –º–∞—Ä—à—Ä—É—Ç:', results[0]?.index || '–Ω–µ –Ω–∞–π–¥–µ–Ω')

				// –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
				console.log('üîç –í—ã–∑—ã–≤–∞–µ–º displayRouteComparison —Å', results.length, '—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏')
				displayRouteComparison(results)

				// –ó–∞–≥—Ä—É–∑–∫–∞ –±—É–¥–µ—Ç —É–±—Ä–∞–Ω–∞ –≤ –≤—ã–∑—ã–≤–∞—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞

				/**
				 * –ü–æ–ª—É—á–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º–∞—Ä—à—Ä—É—Ç–∞ (—Ä–∞–±–æ—Ç–∞—é—â–∏–π –º–µ—Ç–æ–¥)
				 */
				function getRouteCoordinatesFromPaths(route, index) {
					try {
						// –õ–æ–≥–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
						console.log(
							`üîç –ú–∞—Ä—à—Ä—É—Ç ${index + 1}: –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã...`
						)
						console.log(
							'–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã route:',
							Object.getOwnPropertyNames(route).filter(
								name => typeof route[name] === 'function'
							)
						)

						// –ú–µ—Ç–æ–¥ 1: –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ –º–æ–¥–µ–ª—å –º–∞—Ä—à—Ä—É—Ç–∞
						try {
							const model = route.model
							if (model) {
								console.log(
									'–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã model:',
									Object.getOwnPropertyNames(model).filter(
										name => typeof model[name] === 'function'
									)
								)

								if (model.getCoordinates) {
									const coords = model.getCoordinates()
									if (coords && coords.length > 0) {
										const routeCoords = coords.map(coord => {
											if (Array.isArray(coord) && coord.length >= 2) {
												return [coord[1], coord[0]] // [lat, lon]
											}
											return coord
										})
										console.log(
											`‚úÖ –ú–∞—Ä—à—Ä—É—Ç ${index + 1}: –ø–æ–ª—É—á–µ–Ω–æ ${routeCoords.length} —Ç–æ—á–µ–∫ —á–µ—Ä–µ–∑ model.getCoordinates()`
										)
										return createRouteResult(route, index, routeCoords)
									}
								}
							}
						} catch (e) {
							console.log(
								`‚ÑπÔ∏è –ú–µ—Ç–æ–¥ model.getCoordinates() –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∞ ${index + 1}:`,
								e.message
							)
						}

						// –ú–µ—Ç–æ–¥ 2: –ü–æ–ª—É—á–∞–µ–º —á–µ—Ä–µ–∑ –ø—É—Ç–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ —Å–≤–æ–π—Å—Ç–≤ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
						const paths = route.getPaths()
						if (!paths) {
							console.warn(`‚ö†Ô∏è –ú–∞—Ä—à—Ä—É—Ç ${index + 1}: –Ω–µ—Ç –ø—É—Ç–µ–π`)
							return null
						}

						let allCoordinates = []

						paths.each(function (path) {
							if (!path) return

							// –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ —Å–≤–æ–π—Å—Ç–≤ –ø—É—Ç–∏
							try {
								if (path.properties) {
									const pathProps = path.properties.getAll()
									console.log('–°–≤–æ–π—Å—Ç–≤–∞ path:', Object.keys(pathProps))
									if (pathProps.coordinates || pathProps.geometry) {
										const coords =
											pathProps.coordinates ||
											(pathProps.geometry && pathProps.geometry.coordinates)
										if (coords && Array.isArray(coords) && coords.length > 0) {
											const convertedCoords = coords.map(coord => {
												if (Array.isArray(coord) && coord.length >= 2) {
													return [coord[1], coord[0]]
												}
												return coord
											})
											allCoordinates = allCoordinates.concat(convertedCoords)
											return
										}
									}
								}
							} catch (e) {
								console.log(
									'–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∏–∑ path.properties:',
									e.message
								)
							}

							// –ü—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ —Å–µ–≥–º–µ–Ω—Ç—ã - –ø–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ —Å–≤–æ–π—Å—Ç–≤
							const segments = path.getSegments()
							if (segments) {
								segments.each(function (segment) {
									if (!segment) return

									// –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ —Å–≤–æ–π—Å—Ç–≤ —Å–µ–≥–º–µ–Ω—Ç–∞
									try {
										if (segment.properties) {
											const segmentProps = segment.properties.getAll()
											// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–ª—è
											if (segmentProps.coordinates) {
												const coords = segmentProps.coordinates
												if (Array.isArray(coords) && coords.length > 0) {
													const convertedCoords = coords.map(coord => {
														if (Array.isArray(coord) && coord.length >= 2) {
															return [coord[1], coord[0]]
														}
														return coord
													})
													allCoordinates =
														allCoordinates.concat(convertedCoords)
													return
												}
											}

											// –ü—Ä–æ–±—É–µ–º geometry –≤ —Å–≤–æ–π—Å—Ç–≤–∞—Ö
											if (
												segmentProps.geometry &&
												segmentProps.geometry.coordinates
											) {
												const coords = segmentProps.geometry.coordinates
												if (Array.isArray(coords) && coords.length > 0) {
													const convertedCoords = coords.map(coord => {
														if (Array.isArray(coord) && coord.length >= 2) {
															return [coord[1], coord[0]]
														}
														return coord
													})
													allCoordinates =
														allCoordinates.concat(convertedCoords)
												}
											}
										}
									} catch (e) {
										// –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
									}

									// –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞–ø—Ä—è–º—É—é –∏–∑ —Å–µ–≥–º–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å –º–µ—Ç–æ–¥)
									try {
										if (typeof segment.getCoordinates === 'function') {
											const segmentCoords = segment.getCoordinates()
											if (segmentCoords && segmentCoords.length > 0) {
												const convertedCoords = segmentCoords.map(coord => {
													if (Array.isArray(coord) && coord.length >= 2) {
														return [coord[1], coord[0]]
													}
													return coord
												})
												allCoordinates = allCoordinates.concat(convertedCoords)
											}
										}
									} catch (e) {
										// –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º
									}
								})
							}
						})

						if (allCoordinates.length === 0) {
							console.warn(
								`‚ö†Ô∏è –ú–∞—Ä—à—Ä—É—Ç ${index + 1}: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã`
							)
							return null
						}

						console.log(
							`‚úÖ –ú–∞—Ä—à—Ä—É—Ç ${index + 1}: –ø–æ–ª—É—á–µ–Ω–æ ${allCoordinates.length} —Ç–æ—á–µ–∫ —á–µ—Ä–µ–∑ –ø—É—Ç–∏/—Å–µ–≥–º–µ–Ω—Ç—ã`
						)
						return createRouteResult(route, index, allCoordinates)
					} catch (error) {
						console.error(
							`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –º–∞—Ä—à—Ä—É—Ç–∞ ${index + 1}:`,
							error
						)
						return null
					}
				}

				/**
				 * –°–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞ –º–∞—Ä—à—Ä—É—Ç–∞
				 */
				function createRouteResult(route, index, coordinates) {
					// –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ [lat, lon]
					console.log(
						`üîç –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –º–∞—Ä—à—Ä—É—Ç–∞ ${index + 1}: –ø–æ–ª—É—á–µ–Ω–æ ${coordinates.length} —Ç–æ—á–µ–∫`
					)
					if (coordinates.length > 0) {
						console.log(
							`üîç –ü–µ—Ä–≤–∞—è —Ç–æ—á–∫–∞ –î–û –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏: [${coordinates[0][0]?.toFixed(4)}, ${coordinates[0][1]?.toFixed(4)}]`
						)
					}

					const normalizedCoords = coordinates.map((coord, idx) => {
						if (!Array.isArray(coord) || coord.length < 2) {
							return coord
						}

						let [first, second] = coord

						// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç: –µ—Å–ª–∏ –ø–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ > 90, —ç—Ç–æ –¥–æ–ª–≥–æ—Ç–∞ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)
						if (typeof first === 'number' && typeof second === 'number') {
							// –ï—Å–ª–∏ –ø–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ > 90, —ç—Ç–æ —Ç–æ—á–Ω–æ –¥–æ–ª–≥–æ—Ç–∞ (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ [lon, lat])
							if (Math.abs(first) > 90) {
								// –≠—Ç–æ [lon, lat], –Ω—É–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å –º–µ—Å—Ç–∞–º–∏
								if (idx < 3) {
									console.log(
										`  üîÑ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Ç–æ—á–∫–∏ ${idx}: [${first.toFixed(4)}, ${second.toFixed(4)}] -> [${second.toFixed(4)}, ${first.toFixed(4)}]`
									)
								}
								return [second, first]
							}
							// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ä–∞–∑—É–º–Ω—ã—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö –¥–ª—è –ú–æ—Å–∫–≤—ã
							if (first < 50 || first > 60 || second < 30 || second > 40) {
								// –í–æ–∑–º–æ–∂–Ω–æ, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—Å—ë –µ—â—ë –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
								if (
									second >= 50 &&
									second <= 60 &&
									first >= 30 &&
									first <= 40
								) {
									if (idx < 3) {
										console.log(
											`  üîÑ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (–ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É) —Ç–æ—á–∫–∏ ${idx}: [${first.toFixed(4)}, ${second.toFixed(4)}] -> [${second.toFixed(4)}, ${first.toFixed(4)}]`
										)
									}
									return [second, first]
								}
							}
							// –≠—Ç–æ —É–∂–µ [lat, lon]
							return [first, second]
						}

						return coord
					})

					console.log(
						`üîç –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –º–∞—Ä—à—Ä—É—Ç–∞ ${index + 1}: ${coordinates.length} -> ${normalizedCoords.length} —Ç–æ—á–µ–∫`
					)
					if (normalizedCoords.length > 0) {
						const firstPoint = normalizedCoords[0]
						console.log(
							`üîç –ü–µ—Ä–≤–∞—è —Ç–æ—á–∫–∞ –ü–û–°–õ–ï –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏: [${firstPoint[0]?.toFixed(4)}, ${firstPoint[1]?.toFixed(4)}]`
						)
						if (normalizedCoords.length > 1) {
							const secondPoint = normalizedCoords[1]
							console.log(
								`üîç –í—Ç–æ—Ä–∞—è —Ç–æ—á–∫–∞ –ü–û–°–õ–ï –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏: [${secondPoint[0]?.toFixed(4)}, ${secondPoint[1]?.toFixed(4)}]`
							)
						}
					}

					// –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –º–∞—Ä—à—Ä—É—Ç–∞ —Å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
					const safety = calculateRouteSafetyCombined(
						normalizedCoords,
						hotspotsData
					)

					// –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∞—Ä—à—Ä—É—Ç–µ
					let distance = 0
					let duration = 0

					try {
						const distanceProp = route.properties.get('distance')
						if (distanceProp) {
							distance = distanceProp.value || distanceProp || 0
						} else {
							// –ï—Å–ª–∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω–æ –∏–∑ —Å–≤–æ–π—Å—Ç–≤, –≤—ã—á–∏—Å–ª—è–µ–º –∏–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
							distance = calculateRouteLength(normalizedCoords)
						}
					} catch (e) {
						console.log(
							'‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è, –≤—ã—á–∏—Å–ª—è–µ–º –∏–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç'
						)
						distance = calculateRouteLength(normalizedCoords)
					}

					try {
						const durationProp = route.properties.get('duration')
						if (durationProp) {
							duration = durationProp.value || durationProp || 0
						}
					} catch (e) {
						console.log('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤ –ø—É—Ç–∏')
						duration = 0
					}

					console.log(
						`üìè –ú–∞—Ä—à—Ä—É—Ç ${index + 1}: —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ ${(distance / 1000).toFixed(2)} –∫–º, –≤—Ä–µ–º—è ${Math.round(duration / 60)} –º–∏–Ω`
					)

					return {
						index: index + 1,
						route: route,
						coordinates: normalizedCoords,
						distance: distance,
						duration: duration,
						safety: safety,
					}
				}
			}

			/**
			 * –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –≤ UI
			 */
			function displayRouteComparison(results) {
				console.log(
					'üìä –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤:',
					results.length,
					'–º–∞—Ä—à—Ä—É—Ç–æ–≤'
				)
				console.log('üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã (–ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç):', results)

				if (!results || results.length === 0) {
					console.warn('‚ö†Ô∏è –ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è')
					alert(
						'‚ö†Ô∏è –ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.'
					)
					return
				}

				// ========== –í–´–í–û–î –†–ï–ó–£–õ–¨–¢–ê–¢–û–í –í –ö–û–ù–°–û–õ–¨ –î–õ–Ø –û–¢–õ–ê–î–ö–ò ==========
				console.log('\n' + '='.repeat(80))
				console.log('üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–ù–ê–õ–ò–ó–ê –ú–ê–†–®–†–£–¢–û–í (–¥–µ—Ç–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥)')
				console.log('='.repeat(80))
				
				results.forEach((result, idx) => {
					const safety = result.safety
					const distanceKm = (result.distance / 1000).toFixed(2)
					const durationMin = Math.round(result.duration / 60)
					const dangerousKm = (
						(safety.lowLength + safety.mediumLength + safety.highLength) /
						1000
					).toFixed(2)

					console.log(`\nüõ£Ô∏è –ú–ê–†–®–†–£–¢ #${result.index} (${idx === 0 && results.length > 1 ? '‚≠ê –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø' : ''})`)
					console.log('‚îÄ'.repeat(80))
					console.log(`  üìè –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${distanceKm} –∫–º`)
					console.log(`  ‚è±Ô∏è  –í—Ä–µ–º—è –≤ –ø—É—Ç–∏: ${durationMin} –º–∏–Ω`)
					console.log(`  üìä –û—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: ${safety.safetyScore.toFixed(2)} –±–∞–ª–ª–æ–≤`)
					console.log(`  üéØ –£—Ä–æ–≤–µ–Ω—å –æ–ø–∞—Å–Ω–æ—Å—Ç–∏: ${safety.maxRiskLevel} (${safety.maxRiskLevel === 'high' ? 'üî¥ –í—ã—Å–æ–∫–∏–π' : safety.maxRiskLevel === 'medium' ? '‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π' : safety.maxRiskLevel === 'low' ? 'üü° –ù–∏–∑–∫–∏–π' : '‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π'})`)
					console.log(`  ‚ö†Ô∏è  –í—Å–µ–≥–æ –æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω: ${safety.totalZones}`)
					console.log(`     - –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫: ${safety.lowCount} –∑–æ–Ω (${(safety.lowLength/1000).toFixed(2)} –∫–º)`)
					console.log(`     - –°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫: ${safety.mediumCount} –∑–æ–Ω (${(safety.mediumLength/1000).toFixed(2)} –∫–º)`)
					console.log(`     - –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫: ${safety.highCount} –∑–æ–Ω (${(safety.highLength/1000).toFixed(2)} –∫–º)`)
					console.log(`  üö® –û–ø–∞—Å–Ω—ã–π —É—á–∞—Å—Ç–æ–∫: ${dangerousKm} –∫–º (${safety.dangerousPercentage.toFixed(1)}% –æ—Ç –º–∞—Ä—à—Ä—É—Ç–∞)`)
					console.log(`  üìç –í—Å–µ–≥–æ —Ç–æ—á–µ–∫ –º–∞—Ä—à—Ä—É—Ç–∞: ${result.coordinates?.length || 0}`)
					
					if (safety.zones && safety.zones.length > 0) {
						console.log(`  üîç –ü–µ—Ä–µ—Å–µ—á—ë–Ω–Ω—ã–µ –∑–æ–Ω—ã:`)
						safety.zones.forEach((zoneData, zoneIdx) => {
							const zone = zoneData.zone
							console.log(`     ${zoneIdx + 1}. ${zone.riskLevel} —Ä–∏—Å–∫: ${(zoneData.length/1000).toFixed(3)} –∫–º –≤ –∑–æ–Ω–µ [${zone.center[0]?.toFixed(4)}, ${zone.center[1]?.toFixed(4)}]`)
						})
					}
				})
				
				console.log('\n' + '='.repeat(80))
				console.log('‚úÖ –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª—å –∑–∞–≤–µ—Ä—à—ë–Ω')
				console.log('='.repeat(80) + '\n')
				// ========== –ö–û–ù–ï–¶ –í–´–í–û–î–ê –í –ö–û–ù–°–û–õ–¨ ==========

				// –°–æ–∑–¥–∞—ë–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –ø–∞–Ω–µ–ª—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
				let resultsPanel = document.getElementById('routeSafetyResults')
				if (!resultsPanel) {
					resultsPanel = document.createElement('div')
					resultsPanel.id = 'routeSafetyResults'
					resultsPanel.className = 'route-safety-panel'
					document.body.appendChild(resultsPanel)
					console.log('‚úÖ –ü–∞–Ω–µ–ª—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω–∞')
				} else {
					console.log('‚úÖ –ü–∞–Ω–µ–ª—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∞')
				}

				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å
				resultsPanel.style.display = 'block'

				let html = `
					<h3>
						üõ£Ô∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤
						<button class="close-btn" onclick="closeRouteSafetyPanel()" style="
							background: #e74c3c;
							color: white;
							border: none;
							border-radius: 50%;
							width: 28px;
							height: 28px;
							cursor: pointer;
							font-size: 18px;
							line-height: 1;
							display: flex;
							align-items: center;
							justify-content: center;
							padding: 0;
							flex-shrink: 0;
						">√ó</button>
					</h3>
				`

				results.forEach((result, idx) => {
					const safety = result.safety
					const distanceKm = (result.distance / 1000).toFixed(2)
					const durationMin = Math.round(result.duration / 60)
					const dangerousKm = (
						(safety.lowLength + safety.mediumLength + safety.highLength) /
						1000
					).toFixed(2)

					// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –∏ –∏–∫–æ–Ω–∫—É –ø–æ —É—Ä–æ–≤–Ω—é –æ–ø–∞—Å–Ω–æ—Å—Ç–∏
					let safetyIcon = '‚úÖ'
					let safetyColor = '#2ecc71'
					let safetyText = '–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π'

					if (safety.maxRiskLevel === 'high') {
						safetyIcon = 'üî¥'
						safetyColor = '#e74c3c'
						safetyText = '–û–ø–∞—Å–Ω—ã–π'
					} else if (safety.maxRiskLevel === 'medium') {
						safetyIcon = '‚ö†Ô∏è'
						safetyColor = '#f39c12'
						safetyText = '–£–º–µ—Ä–µ–Ω–Ω–æ –æ–ø–∞—Å–Ω—ã–π'
					} else if (safety.maxRiskLevel === 'low') {
						safetyIcon = 'üü°'
						safetyColor = '#f1c40f'
						safetyText = '–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫'
					}

					// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è –ª—É—á—à–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞
					const isRecommended = idx === 0 && results.length > 1
					const recommendedBadge = isRecommended
						? '<span style="background: #2ecc71; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; margin-left: 8px;">‚≠ê –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è</span>'
						: ''

					html += `
						<div class="route-result" data-route-index="${result.index}" style="
							border: 2px solid ${safetyColor};
							border-radius: 8px;
							padding: 1rem;
							margin-bottom: 1rem;
							background: white;
							cursor: pointer;
						">
							<div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
								<h4 style="margin: 0; color: ${safetyColor};">
									${safetyIcon} –ú–∞—Ä—à—Ä—É—Ç ${result.index} ${recommendedBadge}
								</h4>
							</div>
							<div style="font-size: 0.9rem; color: #666;">
								<div>üìè –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${distanceKm} –∫–º</div>
								<div>‚è±Ô∏è –í—Ä–µ–º—è: ${durationMin} –º–∏–Ω</div>
								<div style="margin-top: 0.5rem;">
									<strong>–û—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:</strong> ${safetyText} (${safety.safetyScore.toFixed(2)} –±–∞–ª–ª–æ–≤)
								</div>
								${
									safety.totalZones > 0
										? `
									<div style="margin-top: 0.5rem;">
										‚ö†Ô∏è –û–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω: ${safety.totalZones}
										${safety.lowCount > 0 ? ` (${safety.lowCount} –Ω–∏–∑–∫–∏—Ö)` : ''}
										${safety.mediumCount > 0 ? ` (${safety.mediumCount} —Å—Ä–µ–¥–Ω–∏—Ö)` : ''}
										${safety.highCount > 0 ? ` (${safety.highCount} –≤—ã—Å–æ–∫–∏—Ö)` : ''}
									</div>
									<div>üî¥ –û–ø–∞—Å–Ω—ã–π —É—á–∞—Å—Ç–æ–∫: ${dangerousKm} –∫–º (${safety.dangerousPercentage.toFixed(1)}%)</div>
								`
										: '<div style="color: #2ecc71; margin-top: 0.5rem;">‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç</div>'
								}
							</div>
						</div>
					`
				})

				resultsPanel.innerHTML = html

				// –ü—Ä–æ—Å—Ç–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è
				const closeBtn = resultsPanel.querySelector('.close-btn')
				if (closeBtn) {
					closeBtn.addEventListener('click', function () {
						resultsPanel.style.display = 'none'
					})
				}

				// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–∞—Ä—à—Ä—É—Ç–∞
				resultsPanel.querySelectorAll('.route-result').forEach((el, idx) => {
					el.addEventListener('click', function () {
						const routeIndex = parseInt(this.dataset.routeIndex)
						selectRoute(routeIndex - 1) // –ò–Ω–¥–µ–∫—Å —Å 0
					})
				})

				// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ–º —Å–∞–º—ã–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç
				if (results.length > 0) {
					selectRoute(results[0].index - 1)
				}
			}

			/**
			 * –í—ã–±–∏—Ä–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç –Ω–∞ –∫–∞—Ä—Ç–µ
			 */
			function selectRoute(routeIndex) {
				if (!routeMultiRoute) return

				const routes = routeMultiRoute.getRoutes()
				if (!routes || routes.length <= routeIndex) return

				// –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç
				routes.each(function (route, index) {
					if (index === routeIndex) {
						routeMultiRoute.setActiveRoute(route)
					}
				})
			}

			/**
			 * –¢–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–Ω–∞–ª–∏–∑–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤
			 * –°–æ–∑–¥–∞—ë—Ç –º–∞—Ä—à—Ä—É—Ç –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–æ—á–∫–∞–º–∏ –≤ –ú–æ—Å–∫–≤–µ
			 */
			async function testRouteAnalysis() {
				console.log('üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –º–∞—Ä—à—Ä—É—Ç–∞...')

				// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ–ø–∞—Å–Ω—ã–µ –∑–æ–Ω—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã
				if (!hotspotsData || hotspotsData.length === 0) {
					alert(
						'‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –æ–ø–∞—Å–Ω—ã–µ –∑–æ–Ω—ã!\n\n–û–∂–∏–¥–∞–π—Ç–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–æ–Ω...'
					)
					return
				}

				console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω: ${hotspotsData.length}`)

				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞ –∑–∞–∫—Ä—ã—Ç–∞
				const panel = document.querySelector('.route-safety-panel')
				if (panel) {
					panel.style.display = 'block'
				}

				// –°–æ–∑–¥–∞—ë–º —Ç–µ—Å—Ç–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç: –ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å -> –í–î–ù–•
				const from = '–ú–æ—Å–∫–≤–∞, –ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å'
				const to = '–ú–æ—Å–∫–≤–∞, –í–î–ù–•'

				await createRouteForAnalysis(from, to)
			}

			/**
			 * –°–æ–∑–¥–∞—ë—Ç MultiRoute –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤
			 * @param {string|Array} from - –ù–∞—á–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ (–∞–¥—Ä–µ—Å –∏–ª–∏ [lat, lon])
			 * @param {string|Array} to - –ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ (–∞–¥—Ä–µ—Å –∏–ª–∏ [lat, lon])
			 * @param {boolean} addToMap - –î–æ–±–∞–≤–ª—è—Ç—å –ª–∏ –º–∞—Ä—à—Ä—É—Ç –Ω–∞ –∫–∞—Ä—Ç—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true)
			 */
			async function createRouteForAnalysis(from, to, addToMap = true) {
				if (!from || !to) {
					console.error('‚ùå –£–∫–∞–∂–∏—Ç–µ —Ç–æ—á–∫–∏ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞ –º–∞—Ä—à—Ä—É—Ç–∞')
					return
				}

				// –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–∞—Ä—à—Ä—É—Ç (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ –∫–∞—Ä—Ç—É)
				if (routeMultiRoute && addToMap) {
					map.geoObjects.remove(routeMultiRoute)
					routeMultiRoute = null
				} else if (routeMultiRoute && !addToMap) {
					// –ï—Å–ª–∏ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞ –∫–∞—Ä—Ç—É, –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π
					routeMultiRoute = null
				}

				const loading = document.getElementById('loading')
				loading.classList.add('active')
				loading.querySelector('.loading-text').textContent =
					'–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞...'

				try {
					// –°–æ–∑–¥–∞—ë–º –º—É–ª—å—Ç–∏–º–∞—Ä—à—Ä—É—Ç —Å –ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º referencePoints
					routeMultiRoute = new ymaps.multiRouter.MultiRoute(
						{
							referencePoints: [], // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
							params: {
								routingMode: 'auto', // 'auto', 'masstransit', 'pedestrian'
							},
						},
						{
							boundsAutoApply: addToMap, // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–≥–æ–Ω—è—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞ –∫–∞—Ä—Ç—É
							routeActiveStrokeWidth: 4,
							routeActiveStrokeColor: '#0088ff',
							routeStrokeWidth: 3,
							routeStrokeColor: '#666666',
						}
					)

					// –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞ –∫–∞—Ä—Ç—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
					if (addToMap) {
						map.geoObjects.add(routeMultiRoute)
						console.log('‚úÖ –ú–∞—Ä—à—Ä—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ –∫–∞—Ä—Ç—É')
					} else {
						console.log('‚ÑπÔ∏è –ú–∞—Ä—à—Ä—É—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞, –Ω–æ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ –∫–∞—Ä—Ç—É (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è)')
					}

					// –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞
					routeMultiRoute.model.events.add('requestsuccess', async function () {
						console.log('‚úÖ –ú–∞—Ä—à—Ä—É—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ–º –∞–Ω–∞–ª–∏–∑...')
						try {
							// –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
							await analyzeRoutes()
							// –£–±–∏—Ä–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞
							const loading = document.getElementById('loading')
							if (loading) loading.classList.remove('active')
							
							// –ï—Å–ª–∏ –º–∞—Ä—à—Ä—É—Ç –Ω–µ –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ –∫–∞—Ä—Ç—É, —É–¥–∞–ª—è–µ–º –µ–≥–æ –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞
							if (!addToMap && routeMultiRoute) {
								console.log('üóëÔ∏è –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞ (–æ–Ω –Ω–µ –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ –∫–∞—Ä—Ç—É)')
								routeMultiRoute = null
							}
						} catch (error) {
							console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –º–∞—Ä—à—Ä—É—Ç–∞:', error)
							const loading = document.getElementById('loading')
							if (loading) loading.classList.remove('active')
							
							// –£–¥–∞–ª—è–µ–º –º–∞—Ä—à—Ä—É—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ, –µ—Å–ª–∏ –æ–Ω –Ω–µ –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ –∫–∞—Ä—Ç—É
							if (!addToMap && routeMultiRoute) {
								routeMultiRoute = null
							}
						}
					})

					// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
					routeMultiRoute.model.events.add('requestfail', function () {
						alert(
							'‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç.\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:\n1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∞–¥—Ä–µ—Å–æ–≤\n2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ API –∫–ª—é—á–∞'
						)
						loading.classList.remove('active')
						
						// –£–¥–∞–ª—è–µ–º –º–∞—Ä—à—Ä—É—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ, –µ—Å–ª–∏ –æ–Ω –Ω–µ –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ –∫–∞—Ä—Ç—É
						if (!addToMap && routeMultiRoute) {
							routeMultiRoute = null
						}
					})

					// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ—á–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞ —á–µ—Ä–µ–∑ –º–æ–¥–µ–ª—å (–ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è)
					routeMultiRoute.model.setReferencePoints([from, to])
				} catch (error) {
					console.error('–û—à–∏–±–∫–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞:', error)
					alert('‚ùå –û—à–∏–±–∫–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞: ' + error.message)
					loading.classList.remove('active')
					
					// –£–¥–∞–ª—è–µ–º –º–∞—Ä—à—Ä—É—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ, –µ—Å–ª–∏ –æ–Ω –Ω–µ –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ –∫–∞—Ä—Ç—É
					if (!addToMap && routeMultiRoute) {
						routeMultiRoute = null
					}
				}
			}

			/**
			 * –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏–∑ –º–∞—Ä—à—Ä—É—Ç–∞ –∏–∑ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ (—Ç–æ—á–∫–∏ A –∏ B –≤—ã–±–∏—Ä–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
			 */
			async function buildAndAnalyzeRoute() {
				const from = document.getElementById('routeFrom')?.value?.trim()
				const to = document.getElementById('routeTo')?.value?.trim()

				if (!from || !to) {
					alert(
						'‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ —Ç–æ—á–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è (A) –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (B)!'
					)
					return
				}

				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞ –∑–∞–∫—Ä—ã—Ç–∞
				const panel = document.querySelector('.route-safety-panel')
				if (panel) {
					panel.style.display = 'block'
				}

				console.log(
					'‚úÖ –ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞ –º–∞—Ä—à—Ä—É—Ç–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª —Ç–æ—á–∫–∏):',
					from,
					'->',
					to
				)
				await createRouteForAnalysis(from, to)
			}

			// –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ —á–µ—Ä–µ–∑ MultiRoute API (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å–æ —Å—Ç–∞—Ä—ã–º –∫–æ–¥–æ–º)
			async function buildRoute() {
				// –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞
				await buildAndAnalyzeRoute()

				// –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–∞—Ä—à—Ä—É—Ç
				if (routeMultiRoute) {
					map.geoObjects.remove(routeMultiRoute)
					routeMultiRoute = null
				}

				const loading = document.getElementById('loading')
				loading.classList.add('active')

				try {
					// –°–æ–∑–¥–∞–µ–º –º—É–ª—å—Ç–∏–º–∞—Ä—à—Ä—É—Ç —á–µ—Ä–µ–∑ MultiRoute API
					routeMultiRoute = new ymaps.multiRouter.MultiRoute(
						{
							referencePoints: [from, to],
							params: {
								routingMode: 'auto', // 'auto', 'masstransit', 'pedestrian'
							},
						},
						{
							boundsAutoApply: true,
							// –í–∏–∑—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
							routeActiveStrokeWidth: 4,
							routeActiveStrokeColor: '#0088ff',
							routeStrokeWidth: 3,
							routeStrokeColor: '#666666',
						}
					)

					map.geoObjects.add(routeMultiRoute)

					// –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞
					routeMultiRoute.model.events.add('requestsuccess', function () {
						// –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã
						analyzeRoutes()
						loading.classList.remove('active')
					})

					// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
					routeMultiRoute.model.events.add('requestfail', function () {
						alert(
							'‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç.\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:\n1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∞–¥—Ä–µ—Å–æ–≤\n2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ API –∫–ª—é—á–∞ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞\n3. –ß—Ç–æ –¥–æ–º–µ–Ω localhost –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã'
						)
						loading.classList.remove('active')
					})
				} catch (error) {
					console.error('–û—à–∏–±–∫–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞:', error)
					alert(
						'‚ùå –û—à–∏–±–∫–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞: ' +
							error.message +
							'\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ API –∫–ª—é—á–∞ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞.'
					)
					loading.classList.remove('active')
				}
			}

			/**
			 * –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–∞–Ω–µ–ª—å —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
			 */
			function closeRouteSafetyPanel() {
				const panel = document.getElementById('routeSafetyResults')
				if (panel) {
					panel.style.display = 'none'
				}
			}

			// –û—á–∏—Å—Ç–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞
			function clearRoute() {
				// –û—á–∏—â–∞–µ–º MultiRoute
				if (routeMultiRoute) {
					map.geoObjects.remove(routeMultiRoute)
					routeMultiRoute = null
				}

				// –û—á–∏—â–∞–µ–º –ø–∞–Ω–µ–ª—å –º–∞—Ä—à—Ä—É—Ç–æ–≤ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞)
				try {
					const routePanelControl = map.controls.get('routePanelControl')
					// if (routePanelControl) {
					// 	routePanelControl.routePanel.state.set({
					// 		from: '',
					// 		to: '',
					// 		type: 'auto'
					// 	})
					// }
				} catch (error) {
					// –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –ø–∞–Ω–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
				}

				document.getElementById('routeFrom').value = ''
				document.getElementById('routeTo').value = ''
				document.getElementById('routeInfo').style.display = 'none'
			}
		</script>
	</body>
</html>
