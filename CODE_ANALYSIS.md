# ๐ ะะฝะฐะปะธะท ะบะพะดะฐ ะฟัะพะตะบัะฐ "ะะฝะฐะปะธะท ะะขะ ะฒ ะะพัะบะฒะต"

## ๐ฏ ะะฑัะตะต ะพะฟะธัะฐะฝะธะต ะฟัะพะตะบัะฐ

ะะตะฑ-ะฟัะธะปะพะถะตะฝะธะต ะดะปั ะฒะธะทัะฐะปะธะทะฐัะธะธ ะธ ะฐะฝะฐะปะธะทะฐ ะดะพัะพะถะฝะพ-ััะฐะฝัะฟะพััะฝัั ะฟัะพะธััะตััะฒะธะน ะฒ ะะพัะบะฒะต ั ะฒะพะทะผะพะถะฝะพัััั ััะฐะฒะฝะตะฝะธั ะผะฐัััััะพะฒ ะฟะพ ะฑะตะทะพะฟะฐัะฝะพััะธ. ะัะพะตะบั ะธัะฟะพะปัะทัะตั ะดะฐะฝะฝัะต ะพ ะะขะ (~91,748 ะทะฐะฟะธัะตะน) ะดะปั ะฟะพัััะพะตะฝะธั "ะณะพัััะธั ัะพัะตะบ" (ะพะฟะฐัะฝัั ะทะพะฝ) ะธ ะฐะฝะฐะปะธะทะฐ ะผะฐัััััะพะฒ.

---

## ๐๏ธ ะััะธัะตะบัััะฐ ะฟัะพะตะบัะฐ

### ะกัััะบัััะฐ ะบะพะผะฟะพะฝะตะฝัะพะฒ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Frontend (index.html)                 โ
โ  - ะฏะฝะดะตะบั.ะะฐััั API (ะพัะพะฑัะฐะถะตะฝะธะต ะบะฐััั)                โ
โ  - ะะธะทัะฐะปะธะทะฐัะธั ะพะฟะฐัะฝัั ะทะพะฝ ะธ ะTะ                       โ
โ  - ะะพัััะพะตะฝะธะต ะธ ะฐะฝะฐะปะธะท ะผะฐัััััะพะฒ                        โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                   โ
โโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              Backend API (PHP)                            โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ                    โ
โ  โ accidents.phpโ  โ hotspots.php โ                    โ
โ  โโโโโโโโฌโโโโโโโโ  โโโโโโโโฌโโโโโโโโ                    โ
โ         โ                 โ                             โ
โ  โโโโโโโโผโโโโโโโโโโโโโโโโโโผโโโโโโโโ                    โ
โ  โ      DataLoader (data_loader.php)โ                   โ
โ  โ  - ะฃะฝะธะฒะตััะฐะปัะฝัะน ะทะฐะณััะทัะธะบ       โ                   โ
โ  โ  - ะะพะดะดะตัะถะบะฐ ะะ ะธ ัะฐะนะปะพะฒ         โ                   โ
โ  โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ                   โ
โ         โ                                                โ
โ  โโโโโโโโผโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ                  โ
โ  โ  db.php         โ  โcache_helper โ                  โ
โ  โ  (MySQL PDO)    โ  โ   .php      โ                  โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ                  โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                   โ
         โโโโโโโโโโโดโโโโโโโโโโ
         โ                   โ
โโโโโโโโโโผโโโโโโโโโ  โโโโโโโโผโโโโโโโโโโโ
โ   MySQL ะะ       โ  โ  NDJSON ัะฐะนะป    โ
โ  (accidents)     โ  โ (moskva.ndjson) โ
โโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ะะฝะฐะปะธะท ะบะพะผะฟะพะฝะตะฝัะพะฒ

### 1. Frontend (`index.html`)

**ะะฐะทะผะตั:** ~2,800 ัััะพะบ ะบะพะดะฐ  
**ะขะตัะฝะพะปะพะณะธะธ:** Vanilla JavaScript, ะฏะฝะดะตะบั.ะะฐััั API 2.1

#### โ ะกะธะปัะฝัะต ััะพัะพะฝั:

1. **ะะพะปะฝะพััะฝะบัะธะพะฝะฐะปัะฝัะน ะธะฝัะตััะตะนั:**
   - ะะฝัะตะณัะฐัะธั ั ะฏะฝะดะตะบั.ะะฐััะฐะผะธ
   - ะะธะทัะฐะปะธะทะฐัะธั ะพะฟะฐัะฝัั ะทะพะฝ (ะบััะณะธ ั ัะฐะทะฝัะผะธ ัะฒะตัะฐะผะธ)
   - ะะปะฐััะตัะธะทะฐัะธั ัะพัะตะบ ะะขะ
   - ะะฐะฝะตะปั ัะฟัะฐะฒะปะตะฝะธั ั ัะธะปัััะฐะผะธ

2. **ะะปะณะพัะธัะผ ะฐะฝะฐะปะธะทะฐ ะผะฐัััััะพะฒ:**
   - ะัะฟะพะปัะทัะตั ัะพัะผัะปั Haversine ะดะปั ัะฐััะตัะฐ ัะฐัััะพัะฝะธะน
   - ะัะพะฒะตััะตั ะฟะตัะตัะตัะตะฝะธะต ะผะฐัััััะฐ ั ะพะฟะฐัะฝัะผะธ ะทะพะฝะฐะผะธ
   - ะััะธัะปัะตั ะดะปะธะฝั ััะฐััะบะฐ ะผะฐัััััะฐ ะฒะฝัััะธ ะทะพะฝั
   - ะะพะผะฑะธะฝะธัะพะฒะฐะฝะฝะฐั ะพัะตะฝะบะฐ ะฑะตะทะพะฟะฐัะฝะพััะธ (ะบะพะปะธัะตััะฒะพ + ะดะปะธะฝะฐ)

3. **ะะฟัะธะผะธะทะฐัะธะธ:**
   - ะัะตะดะฒะฐัะธัะตะปัะฝะฐั ัะธะปัััะฐัะธั ะทะพะฝ ะฟะพ bbox ะผะฐัััััะฐ
   - ะัะพะฒะตัะบะฐ ะฝะต ะฒัะตั ัะพัะตะบ, ะฐ ะบะฐะถะดัั N-ั (step)
   - ะััะธัะพะฒะฐะฝะธะต ะทะฐะณััะถะตะฝะฝัั ะดะฐะฝะฝัั

4. **ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ:**
   - ะัะพะฒะตัะบะฐ API ะบะปััะฐ
   - ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ ะบะฐััั
   - ะะฐะปะธะดะฐัะธั ะฒัะพะดะฝัั ะดะฐะฝะฝัั

#### โ๏ธ ะัะพะฑะปะตะผั ะธ ะทะฐะผะตัะฐะฝะธั:

1. **ะะพะฝะพะปะธัะฝัะน ัะฐะนะป:**
   - ะะตัั ะบะพะด ะฒ ะพะดะฝะพะผ ัะฐะนะปะต (2,800 ัััะพะบ)
   - ะกะปะพะถะฝะพ ะฟะพะดะดะตัะถะธะฒะฐัั ะธ ัะตััะธัะพะฒะฐัั
   - ะะตะบะพะผะตะฝะดะฐัะธั: ัะฐะทะฑะธัั ะฝะฐ ะผะพะดัะปะธ

2. **ะัะฑะปะธัะพะฒะฐะฝะธะต ะบะพะดะฐ:**
   - ะะตัะบะพะปัะบะพ ัะฟะพัะพะฑะพะฒ ะฟะพะปััะตะฝะธั ะบะพะพัะดะธะฝะฐั ะผะฐัััััะฐ
   - ะะพะฒัะพััััะฐััั ะปะพะณะธะบะฐ ะฝะพัะผะฐะปะธะทะฐัะธะธ ะบะพะพัะดะธะฝะฐั
   - ะะตะบะพะผะตะฝะดะฐัะธั: ะฒัะฝะตััะธ ะฒ ะพัะดะตะปัะฝัะต ััะฝะบัะธะธ

3. **ะะตััะบะพ ะทะฐะบะพะดะธัะพะฒะฐะฝะฝัะต ะทะฝะฐัะตะฝะธั:**
   ```javascript
   const FIXED_GRID_SIZE = 1000 // ะะฐะทะผะตั ัะตัะบะธ ะดะปั ัะฐััััะฐ
   const BASE_RADIUS = 500     // ะะฐะทะพะฒัะน ัะฐะดะธัั ะดะปั ะฟัะพะฒะตัะบะธ
   ```
   - ะะตะบะพะผะตะฝะดะฐัะธั: ะฒัะฝะตััะธ ะฒ ะบะพะฝัะธะณััะฐัะธั

4. **ะกะปะพะถะฝะฐั ะปะพะณะธะบะฐ ะฟะพะปััะตะฝะธั ะบะพะพัะดะธะฝะฐั:**
   - ะะฝะพะถะตััะฒะพ ะฟะพะฟััะพะบ ัะตัะตะท ัะฐะทะฝัะต ะผะตัะพะดั API
   - ะะฝะพะณะพ ะพัะปะฐะดะพัะฝะพะณะพ ะบะพะดะฐ (console.log)
   - ะะตะบะพะผะตะฝะดะฐัะธั: ัะฟัะพััะธัั ะธ ะพัะธััะธัั

5. **ะะปะพะฑะฐะปัะฝัะต ะฟะตัะตะผะตะฝะฝัะต:**
   ```javascript
   let map, hotspotsCollection, routeMultiRoute, clusterer
   let accidentsData = []
   let hotspotsData = []
   ```
   - ะะตะบะพะผะตะฝะดะฐัะธั: ะธัะฟะพะปัะทะพะฒะฐัั ะผะพะดัะปัะฝัะน ะฟะฐััะตัะฝ ะธะปะธ ะบะปะฐัั

#### ๐ ะะปััะตะฒัะต ััะฝะบัะธะธ:

- `loadHotspotsOnce()` - ะทะฐะณััะทะบะฐ ะพะฟะฐัะฝัั ะทะพะฝ ะพะดะธะฝ ัะฐะท ะฟัะธ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ
- `calculateRouteSafetyCombined()` - ะบะพะผะฑะธะฝะธัะพะฒะฐะฝะฝะฐั ะพัะตะฝะบะฐ ะฑะตะทะพะฟะฐัะฝะพััะธ ะผะฐัััััะฐ
- `calculateLengthInZone()` - ะฒััะธัะปะตะฝะธะต ะดะปะธะฝั ััะฐััะบะฐ ะผะฐัััััะฐ ะฒะฝัััะธ ะทะพะฝั
- `getZonesNearRoute()` - ะฟัะตะดะฒะฐัะธัะตะปัะฝะฐั ัะธะปัััะฐัะธั ะทะพะฝ ะฟะพ bbox
- `analyzeRoutes()` - ะฐะฝะฐะปะธะท ะฒัะตั ะผะฐัััััะพะฒ ะธะท MultiRoute

---

### 2. Backend API

#### 2.1 `accidents.php` - API ะดะปั ะฟะพะปััะตะฝะธั ะะขะ

**ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั:**
- ะะพะปััะตะฝะธะต ะดะฐะฝะฝัั ะพ ะะขะ ะฟะพ bbox (ะณัะฐะฝะธัั ะบะฐััั)
- ะคะธะปัััะฐัะธั ะฟะพ ะดะฐัะฐะผ
- ะะณัะฐะฝะธัะตะฝะธะต ะบะพะปะธัะตััะฒะฐ ัะตะทัะปััะฐัะพะฒ (limit)
- ะััะธัะพะฒะฐะฝะธะต ะพัะฒะตัะพะฒ

**ะะฐัะฐะผะตััั ะทะฐะฟัะพัะฐ:**
- `bbox` - ะณัะฐะฝะธัั ะพะฑะปะฐััะธ (minLon,minLat,maxLon,maxLat)
- `from` / `to` - ะดะธะฐะฟะฐะทะพะฝ ะดะฐั (ะพะฟัะธะพะฝะฐะปัะฝะพ)
- `days` - ะบะพะปะธัะตััะฒะพ ะดะฝะตะน ะฝะฐะทะฐะด (ะพะฟัะธะพะฝะฐะปัะฝะพ)
- `limit` - ะผะฐะบัะธะผะฐะปัะฝะพะต ะบะพะปะธัะตััะฒะพ ัะตะทัะปััะฐัะพะฒ (ะฟะพ ัะผะพะปัะฐะฝะธั 1000)

**ะคะพัะผะฐั ะพัะฒะตัะฐ:** GeoJSON FeatureCollection

**โ ะฅะพัะพัะพ:**
- ะะฐะปะธะดะฐัะธั ะฒัะพะดะฝัั ะฟะฐัะฐะผะตััะพะฒ
- ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ
- ะััะธัะพะฒะฐะฝะธะต
- ะะพะดะดะตัะถะบะฐ CORS

**โ๏ธ ะะฐะผะตัะฐะฝะธั:**
- ะะธะผะธั bbox (1.0 ะณัะฐะดัั) ะผะพะถะตั ะฑััั ัะปะธัะบะพะผ ัััะพะณะธะผ
- ะะตั ะฟะฐะณะธะฝะฐัะธะธ ะดะปั ะฑะพะปััะธั ัะตะทัะปััะฐัะพะฒ

---

#### 2.2 `hotspots.php` - API ะดะปั ะฟะพะปััะตะฝะธั ะพะฟะฐัะฝัั ะทะพะฝ

**ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั:**
- ะะฐััะตั ะพะฟะฐัะฝัั ะทะพะฝ ะฝะฐ ะพัะฝะพะฒะต ัะตัะบะธ (grid)
- ะคะธะปัััะฐัะธั ะฟะพ ะฟะตัะธะพะดั ะฒัะตะผะตะฝะธ
- ะะฟัะตะดะตะปะตะฝะธะต ััะพะฒะฝั ะพะฟะฐัะฝะพััะธ ะฟะพ ะฟะปะพัะฝะพััะธ ะะขะ
- ะะพะทะฒัะฐั ะบััะณะพะฒัั ะทะพะฝ ั ัะฐะดะธััะพะผ

**ะะฐัะฐะผะตััั ะทะฐะฟัะพัะฐ:**
- `bbox` - ะณัะฐะฝะธัั ะพะฑะปะฐััะธ
- `period` - ะฟะตัะธะพะด ะฐะฝะฐะปะธะทะฐ (all, 7d, 30d, 90d, 365d)
- `threshold` - ะผะธะฝะธะผะฐะปัะฝะพะต ะบะพะปะธัะตััะฒะพ ะะขะ ะฒ ะทะพะฝะต (ะฟะพ ัะผะพะปัะฐะฝะธั 5)
- `grid` - ัะฐะทะผะตั ััะตะนะบะธ ัะตัะบะธ ะฒ ะผะตััะฐั (ะฟะพ ัะผะพะปัะฐะฝะธั 1000)

**ะะปะณะพัะธัะผ ัะฐััะตัะฐ:**
1. ะกะพะทะดะฐะฝะธะต ัะตัะบะธ ั ัะฐะทะผะตัะพะผ ััะตะนะบะธ = `gridSize`
2. ะะพะดััะตั ะะขะ ะฒ ะบะฐะถะดะพะน ััะตะนะบะต
3. ะคะธะปัััะฐัะธั ััะตะตะบ ะฟะพ ะฟะพัะพะณั (`threshold`)
4. ะะฐััะตั ะฟะปะพัะฝะพััะธ ะะขะ ะฝะฐ 1000 ะผยฒ
5. ะะฟัะตะดะตะปะตะฝะธะต ััะพะฒะฝั ะพะฟะฐัะฝะพััะธ:
   - `low`: 0.1-0.2
   - `medium`: 0.2-0.3
   - `high`: โฅ 0.3

**โ ะฅะพัะพัะพ:**
- ะะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัะน ะฐะปะณะพัะธัะผ ั ะฟััะผัะผ ะดะพัััะฟะพะผ ะบ ััะตะนะบะฐะผ (O(1))
- ะะพะณะธัะพะฒะฐะฝะธะต ััะฐัะธััะธะบะธ ะดะปั ะพัะปะฐะดะบะธ
- ะััะธัะพะฒะฐะฝะธะต ัะตะทัะปััะฐัะพะฒ

**โ๏ธ ะะฐะผะตัะฐะฝะธั:**
- ะะฐะดะธัั ะทะพะฝั = `gridSize / 2`, ััะพ ะผะพะถะตั ะฑััั ะฝะตะพะฟัะธะผะฐะปัะฝะพ
- ะะพะฝั ั ะฝะธะทะบะธะผ ััะพะฒะฝะตะผ ะพัะพะฑัะฐะถะฐัััั ัะพะปัะบะพ ะฟัะธ `gridSize <= 500ะผ`
- ะะตั ะฒะพะทะผะพะถะฝะพััะธ ะฝะฐัััะพะธัั ะฟะพัะพะณะธ ะฟะปะพัะฝะพััะธ

---

#### 2.3 `data_loader.php` - ะฃะฝะธะฒะตััะฐะปัะฝัะน ะทะฐะณััะทัะธะบ ะดะฐะฝะฝัั

**ะะปะฐัั:** `DataLoader`

**ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั:**
- ะะพะดะดะตัะถะบะฐ ะดะฒัั ะธััะพัะฝะธะบะพะฒ ะดะฐะฝะฝัั: ะะ ะธ ัะฐะนะป (NDJSON)
- ะะฐะณััะทะบะฐ ะดะฐะฝะฝัั ะพะดะธะฝ ัะฐะท (singleton pattern)
- ะคะธะปัััะฐัะธั ะฟะพ bbox ะธ ะดะฐัะฐะผ
- ะะฟัะธะผะธะทะธัะพะฒะฐะฝะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ะฑะพะปััะธั ัะฐะนะปะพะฒ

**ะะตัะพะดั:**
- `getAccidents($bbox, $from, $to, $limit)` - ะฟะพะปััะตะฝะธะต ะะขะ
- `getHotspotsStats($bbox, $period, $threshold, $gridSize)` - ััะฐัะธััะธะบะฐ ะดะปั ะทะพะฝ
- `loadAccidentsDataOnce()` - ะทะฐะณััะทะบะฐ ะดะฐะฝะฝัั ะธะท ัะฐะนะปะฐ (singleton)

**โ ะฅะพัะพัะพ:**
- ะะดะธะฝัะน ะธะฝัะตััะตะนั ะดะปั ะะ ะธ ัะฐะนะปะฐ
- ะะฟัะธะผะธะทะฐัะธั ะฟะฐะผััะธ (ะทะฐะณััะทะบะฐ ะพะดะธะฝ ัะฐะท)
- ะะฑัะฐะฑะพัะบะฐ ะฑะพะปััะธั ัะฐะนะปะพะฒ (ัะฒะตะปะธัะตะฝะธะต ะปะธะผะธัะพะฒ)
- ะะพะณะธัะพะฒะฐะฝะธะต ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

**โ๏ธ ะะฐะผะตัะฐะฝะธั:**
- ะกัะฐัะธัะตัะบะธะน ะบัั ะฒ ะฟะฐะผััะธ ะผะพะถะตั ะฑััั ะฟัะพะฑะปะตะผะพะน ะฟัะธ ะฑะพะปััะธั ะดะฐะฝะฝัั
- ะะตั ะผะตัะฐะฝะธะทะผะฐ ะธะฝะฒะฐะปะธะดะฐัะธะธ ะบััะฐ (ะบัะพะผะต GET ะฟะฐัะฐะผะตััะฐ)
- ะัะธ ัะฐะฑะพัะต ั ัะฐะนะปะพะผ ะฒัะต ะดะฐะฝะฝัะต ะทะฐะณััะถะฐัััั ะฒ ะฟะฐะผััั

**ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั:**
- ะะฐะณััะทะบะฐ ~91k ะทะฐะฟะธัะตะน ะธะท NDJSON: ~2-5 ัะตะบัะฝะด
- ะะฑัะฐะฑะพัะบะฐ ะดะปั hotspots: O(n) ะณะดะต n - ะบะพะปะธัะตััะฒะพ ะะขะ

---

#### 2.4 `cache_helper.php` - ะะฐะฑะพัะฐ ั ะบััะตะผ

**ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั:**
- ะคะฐะนะปะพะฒัะน ะบัั ะดะปั API ะพัะฒะตัะพะฒ
- TTL (ะฒัะตะผั ะถะธะทะฝะธ ะบััะฐ)
- MD5 ัะตัะธัะพะฒะฐะฝะธะต ะบะปััะตะน

**ะคัะฝะบัะธะธ:**
- `getCache($key, $config)` - ะฟะพะปััะตะฝะธะต ะธะท ะบััะฐ
- `setCache($key, $data, $config)` - ัะพััะฐะฝะตะฝะธะต ะฒ ะบัั
- `clearCache($config)` - ะพัะธััะบะฐ ะฒัะตะณะพ ะบััะฐ

**โ ะฅะพัะพัะพ:**
- ะัะพััะฐั ัะตะฐะปะธะทะฐัะธั
- ะะฒัะพะผะฐัะธัะตัะบะพะต ัะพะทะดะฐะฝะธะต ะดะธัะตะบัะพัะธะธ
- ะัะพะฒะตัะบะฐ TTL

**โ๏ธ ะะฐะผะตัะฐะฝะธั:**
- ะะตั ัะถะฐัะธั ะดะฐะฝะฝัั (ะผะพะถะตั ะทะฐะฝะธะผะฐัั ะผะฝะพะณะพ ะผะตััะฐ)
- ะะตั ะธะฝะฒะฐะปะธะดะฐัะธะธ ะฟะพ ะทะฐะฒะธัะธะผะพัััะผ
- ะคะฐะนะปะพะฒัะน ะบัั ะผะพะถะตั ะฑััั ะผะตะดะปะตะฝะฝัะผ ะฟัะธ ะฑะพะปััะพะผ ะบะพะปะธัะตััะฒะต ัะฐะนะปะพะฒ

---

#### 2.5 `config.php` - ะะพะฝัะธะณััะฐัะธั

**ะกัััะบัััะฐ:**
```php
[
    'data_source' => 'file', // ะธะปะธ 'database'
    'database' => [...],
    'file' => [...],
    'cache' => [...],
    'api' => [...]
]
```

**โ ะฅะพัะพัะพ:**
- ะฆะตะฝััะฐะปะธะทะพะฒะฐะฝะฝะฐั ะบะพะฝัะธะณััะฐัะธั
- ะะธะฑะบะพััั ะฒัะฑะพัะฐ ะธััะพัะฝะธะบะฐ ะดะฐะฝะฝัั
- ะะฐัััะพะนะบะธ ะบััะฐ

**โ๏ธ ะะฐะผะตัะฐะฝะธั:**
- ะะตั ะฟัะธะผะตัะฐ ะบะพะฝัะธะณััะฐัะธะธ (ัะพะปัะบะพ `config.php.example`)
- ะะตััะบะพ ะทะฐะบะพะดะธัะพะฒะฐะฝะฝัะต ะทะฝะฐัะตะฝะธั ะฒ ะบะพะดะต (ะฝะฐะฟัะธะผะตั, ะฟะพัะพะณะธ ะฟะปะพัะฝะพััะธ)

---

### 3. ะะฐะทะฐ ะดะฐะฝะฝัั (`schema.sql`)

**ะขะฐะฑะปะธัั:**

1. **`accidents`** - ะพัะฝะพะฒะฝะฐั ัะฐะฑะปะธัะฐ ั ะะขะ
   - Spatial ะธะฝะดะตะบั ะฝะฐ `geom` (POINT)
   - ะะฝะดะตะบัั ะฝะฐ `dt`, `category`, `severity`, `region`
   - JSON ะฟะพะปั ะดะปั ะดะพะฟะพะปะฝะธัะตะปัะฝัั ะดะฐะฝะฝัั

2. **`grid_stats`** - ะฐะณัะตะณะฐัะธั ะฟะพ ัะตัะบะต (ะฝะต ะธัะฟะพะปัะทัะตััั ะฒ ัะตะบััะตะน ัะตะฐะปะธะทะฐัะธะธ)
   - ะัะตะดะฝะฐะทะฝะฐัะตะฝะฐ ะดะปั ะฑััััะพะณะพ ะพัะพะฑัะฐะถะตะฝะธั
   - ะะพะบะฐ ะฝะต ะทะฐะฟะพะปะฝัะตััั

**โ ะฅะพัะพัะพ:**
- ะัะฐะฒะธะปัะฝะพะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต spatial ัะธะฟะพะฒ
- ะะฝะดะตะบัั ะดะปั ะพะฟัะธะผะธะทะฐัะธะธ ะทะฐะฟัะพัะพะฒ
- ะะพะดะดะตัะถะบะฐ JSON ะดะปั ะณะธะฑะบะพััะธ

**โ๏ธ ะะฐะผะตัะฐะฝะธั:**
- ะขะฐะฑะปะธัะฐ `grid_stats` ะฝะต ะธัะฟะพะปัะทัะตััั
- ะะตั ะผะธะณัะฐัะธะน ะดะปั ะพะฑะฝะพะฒะปะตะฝะธั ััะตะผั
- ะะตั ะธะฝะดะตะบัะพะฒ ะฝะฐ JSON ะฟะพะปั (ะตัะปะธ ะฝัะถะตะฝ ะฟะพะธัะบ)

---

## ๐ ะะปะณะพัะธัะผั ะธ ะปะพะณะธะบะฐ

### 1. ะะฐััะตั ะพะฟะฐัะฝัั ะทะพะฝ

**ะะปะณะพัะธัะผ:**
1. ะกะพะทะดะฐะฝะธะต ัะตัะบะธ ั ัะฐะทะผะตัะพะผ ััะตะนะบะธ = `gridSize` (ะฟะพ ัะผะพะปัะฐะฝะธั 1000ะผ)
2. ะะฐัะฟัะตะดะตะปะตะฝะธะต ะะขะ ะฟะพ ััะตะนะบะฐะผ (O(1) ะดะพัััะฟ)
3. ะคะธะปัััะฐัะธั ััะตะตะบ ะฟะพ ะฟะพัะพะณั (`threshold >= 5`)
4. ะะฐััะตั ะฟะปะพัะฝะพััะธ: `(count / area) * 1000` (ะฝะฐ 1000 ะผยฒ)
5. ะะฟัะตะดะตะปะตะฝะธะต ััะพะฒะฝั ะพะฟะฐัะฝะพััะธ ะฟะพ ะฟะพัะพะณะฐะผ ะฟะปะพัะฝะพััะธ

**ะกะปะพะถะฝะพััั:** O(n) ะณะดะต n - ะบะพะปะธัะตััะฒะพ ะะขะ

**ะะฟัะธะผะธะทะฐัะธะธ:**
- ะััะผะพะน ะดะพัััะฟ ะบ ััะตะนะบะฐะผ ัะตัะตะท ะธะฝะดะตะบัั
- ะัะตะดะฒะฐัะธัะตะปัะฝะฐั ัะธะปัััะฐัะธั ะฟะพ bbox
- ะััะธัะพะฒะฐะฝะธะต ัะตะทัะปััะฐัะพะฒ

---

### 2. ะะฝะฐะปะธะท ะฑะตะทะพะฟะฐัะฝะพััะธ ะผะฐัััััะฐ

**ะะปะณะพัะธัะผ:**
1. ะะพะปััะตะฝะธะต ะบะพะพัะดะธะฝะฐั ะผะฐัััััะฐ ะธะท ะฏะฝะดะตะบั.ะะฐัั API
2. ะัะตะดะฒะฐัะธัะตะปัะฝะฐั ัะธะปัััะฐัะธั ะทะพะฝ ะฟะพ bbox ะผะฐัััััะฐ
3. ะะปั ะบะฐะถะดะพะน ะทะพะฝั:
   - ะัะพะฒะตัะบะฐ ะฟะตัะตัะตัะตะฝะธั ั ะผะฐัััััะพะผ
   - ะััะธัะปะตะฝะธะต ะดะปะธะฝั ััะฐััะบะฐ ะฒะฝัััะธ ะทะพะฝั
4. ะะพะผะฑะธะฝะธัะพะฒะฐะฝะฝะฐั ะพัะตะฝะบะฐ:
   - `countScore = low*1 + medium*2 + high*3`
   - `lengthScore = (lowLength*1 + mediumLength*2 + highLength*3) / 1000`
   - `safetyScore = countScore * 0.4 + lengthScore * 0.6`

**ะคะพัะผัะปะฐ ัะฐัััะพัะฝะธั:** Haversine (ัะพัะฝะฐั ะดะปั ััะตัะธัะตัะบะพะน ะะตะผะปะธ)

**ะกะปะพะถะฝะพััั:** O(m * n) ะณะดะต m - ะบะพะปะธัะตััะฒะพ ัะพัะตะบ ะผะฐัััััะฐ, n - ะบะพะปะธัะตััะฒะพ ะทะพะฝ

**ะะฟัะธะผะธะทะฐัะธะธ:**
- ะัะตะดะฒะฐัะธัะตะปัะฝะฐั ัะธะปัััะฐัะธั ะทะพะฝ ะฟะพ bbox
- ะัะพะฒะตัะบะฐ ะฝะต ะฒัะตั ัะพัะตะบ, ะฐ ะบะฐะถะดัั N-ั
- ะััะธัะพะฒะฐะฝะธะต ะฒััะธัะปะตะฝะฝัั ัะฐัััะพัะฝะธะน (ะฝะต ัะตะฐะปะธะทะพะฒะฐะฝะพ)

---

## ๐ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### ะขะตะบััะธะต ะฟะพะบะฐะทะฐัะตะปะธ:

1. **ะะฐะณััะทะบะฐ ะดะฐะฝะฝัั ะธะท ัะฐะนะปะฐ:**
   - ~91,748 ะทะฐะฟะธัะตะน ะทะฐ 2-5 ัะตะบัะฝะด
   - ะะฐะผััั: ~512MB (ะฝะฐัััะพะนะบะฐ ะฒ ะบะพะดะต)

2. **ะะฐััะตั hotspots:**
   - ะะปั ะฒัะตะน ะะพัะบะฒั (bbox ~1ยฐ): ~5-10 ัะตะบัะฝะด
   - ะััะธัะพะฒะฐะฝะธะต: ะฟะตัะฒัะน ะทะฐะฟัะพั ะผะตะดะปะตะฝะฝัะน, ะฟะพัะปะตะดัััะธะต ะฑัััััะต

3. **API ะพัะฒะตัั:**
   - ะก ะบััะตะผ: < 100ms
   - ะะตะท ะบััะฐ: ะทะฐะฒะธัะธั ะพั ะพะฑัะตะผะฐ ะดะฐะฝะฝัั

### ะะพัะตะฝัะธะฐะปัะฝัะต ะฟัะพะฑะปะตะผั:

1. **ะะฐะผััั:**
   - ะัะต ะดะฐะฝะฝัะต ะทะฐะณััะถะฐัััั ะฒ ะฟะฐะผััั ะฟัะธ ัะฐะฑะพัะต ั ัะฐะนะปะพะผ
   - ะัะธ ะฑะพะปััะพะผ ะบะพะปะธัะตััะฒะต ะทะฐะฟัะพัะพะฒ ะผะพะถะตั ะฑััั ะฟัะพะฑะปะตะผะฐ

2. **ะคะฐะนะปะพะฒัะน ะบัั:**
   - ะะฝะพะณะพ ัะฐะนะปะพะฒ ะฒ ะดะธัะตะบัะพัะธะธ `cache/`
   - ะะตั ะพัะธััะบะธ ััะฐััั ัะฐะนะปะพะฒ (ะบัะพะผะต TTL)

3. **ะะฐะทะฐ ะดะฐะฝะฝัั:**
   - ะัะธ ัะฐะฑะพัะต ั ะะ ะทะฐะฟัะพัั ะผะพะณัั ะฑััั ะผะตะดะปะตะฝะฝัะผะธ ะฑะตะท ะธะฝะดะตะบัะพะฒ
   - Spatial ะทะฐะฟัะพัั ััะตะฑััั ะฟัะฐะฒะธะปัะฝัั ะธะฝะดะตะบัะพะฒ

---

## ๐ ะะพัะตะฝัะธะฐะปัะฝัะต ะฟัะพะฑะปะตะผั

### 1. ะะตะทะพะฟะฐัะฝะพััั

- โ **ะะตั ะฒะฐะปะธะดะฐัะธะธ ะฒัะพะดะฝัั ะดะฐะฝะฝัั ะฝะฐ ััะพัะพะฝะต ะบะปะธะตะฝัะฐ**
- โ **API ะบะปัั ะฏะฝะดะตะบั.ะะฐัั ะฒ ะพัะบัััะพะผ ะฒะธะดะต ะฒ HTML**
- โ **ะะตั ะทะฐัะธัั ะพั SQL-ะธะฝัะตะบัะธะน** (ะธัะฟะพะปัะทัะตััั PDO, ะฝะพ ััะพะธั ะฟัะพะฒะตัะธัั)
- โ **ะะตั rate limiting** ะดะปั API

### 2. ะัะธะฑะบะธ

- โ๏ธ **ะะฝะพะณะพ ะพัะปะฐะดะพัะฝะพะณะพ ะบะพะดะฐ** (console.log)
- โ๏ธ **ะะตั ะพะฑัะฐะฑะพัะบะธ ะฒัะตั edge cases**
- โ๏ธ **ะะตั unit-ัะตััะพะฒ**

### 3. ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

- โ๏ธ **ะะพะฝะพะปะธัะฝัะน frontend ัะฐะนะป** (2,800 ัััะพะบ)
- โ๏ธ **ะัะต ะดะฐะฝะฝัะต ะฒ ะฟะฐะผััะธ** ะฟัะธ ัะฐะฑะพัะต ั ัะฐะนะปะพะผ
- โ๏ธ **ะะตั ะฟะฐะณะธะฝะฐัะธะธ** ะดะปั ะฑะพะปััะธั ัะตะทัะปััะฐัะพะฒ

### 4. ะะพะดะดะตัะถะธะฒะฐะตะผะพััั

- โ๏ธ **ะัะฑะปะธัะพะฒะฐะฝะธะต ะบะพะดะฐ** ะฒ ัะฐะทะฝัั ะผะตััะฐั
- โ๏ธ **ะะตััะบะพ ะทะฐะบะพะดะธัะพะฒะฐะฝะฝัะต ะทะฝะฐัะตะฝะธั**
- โ๏ธ **ะกะปะพะถะฝะฐั ะปะพะณะธะบะฐ ะฟะพะปััะตะฝะธั ะบะพะพัะดะธะฝะฐั ะผะฐัััััะฐ**

---

## โ ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ัะปัััะตะฝะธั

### 1. ะะตัะฐะบัะพัะธะฝะณ Frontend

```javascript
// ะะฐะทะฑะธัั ะฝะฐ ะผะพะดัะปะธ:
- map.js          // ะะฝะธัะธะฐะปะธะทะฐัะธั ะบะฐััั
- hotspots.js     // ะะฐะฑะพัะฐ ั ะพะฟะฐัะฝัะผะธ ะทะพะฝะฐะผะธ
- routes.js       // ะะฝะฐะปะธะท ะผะฐัััััะพะฒ
- ui.js           // ะะฝัะตััะตะนั ะฟะพะปัะทะพะฒะฐัะตะปั
- utils.js        // ะฃัะธะปะธัั (ัะฐัััะพัะฝะธั, ะบะพะพัะดะธะฝะฐัั)
```

### 2. ะะฟัะธะผะธะทะฐัะธั Backend

- ะะพะฑะฐะฒะธัั ะฟะฐะณะธะฝะฐัะธั ะดะปั API
- ะัะฟะพะปัะทะพะฒะฐัั Redis ะดะปั ะบััะฐ ะฒะผะตััะพ ัะฐะนะปะพะฒ
- ะะพะฑะฐะฒะธัั rate limiting
- ะะฟัะธะผะธะทะธัะพะฒะฐัั ะทะฐะฟัะพัั ะบ ะะ

### 3. ะะตะทะพะฟะฐัะฝะพััั

- ะัะฝะตััะธ API ะบะปัั ะฒ ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
- ะะพะฑะฐะฒะธัั ะฒะฐะปะธะดะฐัะธั ะฝะฐ ะบะปะธะตะฝัะต
- ะะพะฑะฐะฒะธัั rate limiting
- ะัะฟะพะปัะทะพะฒะฐัั HTTPS

### 4. ะขะตััะธัะพะฒะฐะฝะธะต

- Unit-ัะตััั ะดะปั ะฐะปะณะพัะธัะผะพะฒ ัะฐััะตัะฐ
- ะะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั ะดะปั API
- E2E ัะตััั ะดะปั frontend

### 5. ะะพะบัะผะตะฝัะฐัะธั

- API ะดะพะบัะผะตะฝัะฐัะธั (Swagger/OpenAPI)
- ะะพะผะผะตะฝัะฐัะธะธ ะฒ ะบะพะดะต
- ะัะบะพะฒะพะดััะฒะพ ะฟะพ ัะฐะทะฒะตัััะฒะฐะฝะธั

---

## ๐ ะะตััะธะบะธ ะบะฐัะตััะฒะฐ ะบะพะดะฐ

| ะะตััะธะบะฐ | ะะฝะฐัะตะฝะธะต | ะัะตะฝะบะฐ |
|---------|----------|--------|
| ะะฐะทะผะตั frontend ัะฐะนะปะฐ | ~2,800 ัััะพะบ | โ๏ธ ะกะปะธัะบะพะผ ะฑะพะปััะพะน |
| ะะพะปะธัะตััะฒะพ ััะฝะบัะธะน | ~30+ | โ ะะพัะผะฐะปัะฝะพ |
| ะัะฑะปะธัะพะฒะฐะฝะธะต ะบะพะดะฐ | ะกัะตะดะฝะตะต | โ๏ธ ะััั ะดัะฑะปะธัะพะฒะฐะฝะธะต |
| ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ | ะฅะพัะพัะฐั | โ |
| ะะพะผะผะตะฝัะฐัะธะธ | ะะธะฝะธะผะฐะปัะฝัะต | โ๏ธ ะัะถะฝะพ ะฑะพะปััะต |
| ะขะตััั | ะััััััะฒััั | โ |
| ะะตะทะพะฟะฐัะฝะพััั | ะะฐะทะพะฒะฐั | โ๏ธ ะัะถะฝั ัะปัััะตะฝะธั |

---

## ๐ฏ ะัะฒะพะดั

### ะกะธะปัะฝัะต ััะพัะพะฝั:

1. โ **ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั:** ะะพะปะฝะพัะตะฝะฝะพะต ะฟัะธะปะพะถะตะฝะธะต ั ะฐะฝะฐะปะธะทะพะผ ะผะฐัััััะพะฒ
2. โ **ะะปะณะพัะธัะผั:** ะัะฐะฒะธะปัะฝะพะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ัะพัะผัะป (Haversine)
3. โ **ะะฟัะธะผะธะทะฐัะธะธ:** ะัะตะดะฒะฐัะธัะตะปัะฝะฐั ัะธะปัััะฐัะธั, ะบััะธัะพะฒะฐะฝะธะต
4. โ **ะะธะฑะบะพััั:** ะะพะดะดะตัะถะบะฐ ะะ ะธ ัะฐะนะปะพะฒ ะบะฐะบ ะธััะพัะฝะธะบะพะฒ ะดะฐะฝะฝัั

### ะะฑะปะฐััะธ ะดะปั ัะปัััะตะฝะธั:

1. โ๏ธ **ะััะธัะตะบัััะฐ:** ะะพะฝะพะปะธัะฝัะน frontend ัะฐะนะป
2. โ๏ธ **ะะตะทะพะฟะฐัะฝะพััั:** API ะบะปัั ะฒ ะพัะบัััะพะผ ะฒะธะดะต
3. โ๏ธ **ะขะตััะธัะพะฒะฐะฝะธะต:** ะััััััะฒััั ัะตััั
4. โ๏ธ **ะะพะบัะผะตะฝัะฐัะธั:** ะะธะฝะธะผะฐะปัะฝัะต ะบะพะผะผะตะฝัะฐัะธะธ

### ะะฑัะฐั ะพัะตะฝะบะฐ: **7/10**

ะัะพะตะบั ััะฝะบัะธะพะฝะฐะปะตะฝ ะธ ัะฐะฑะพัะฐะตั, ะฝะพ ััะตะฑัะตั ัะตัะฐะบัะพัะธะฝะณะฐ ะดะปั ัะปัััะตะฝะธั ะฟะพะดะดะตัะถะธะฒะฐะตะผะพััะธ ะธ ะฑะตะทะพะฟะฐัะฝะพััะธ.

---

## ๐ ะะปะฐะฝ ะดะตะนััะฒะธะน

### ะัะธะพัะธัะตั 1 (ะัะธัะธัะฝะพ):
1. ะัะฝะตััะธ API ะบะปัั ะฒ ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
2. ะะพะฑะฐะฒะธัั ะฒะฐะปะธะดะฐัะธั ะฒัะพะดะฝัั ะดะฐะฝะฝัั
3. ะะพะฑะฐะฒะธัั rate limiting ะดะปั API

### ะัะธะพัะธัะตั 2 (ะะฐะถะฝะพ):
1. ะะฐะทะฑะธัั frontend ะฝะฐ ะผะพะดัะปะธ
2. ะะพะฑะฐะฒะธัั unit-ัะตััั ะดะปั ะฐะปะณะพัะธัะผะพะฒ
3. ะะฟัะธะผะธะทะธัะพะฒะฐัั ัะฐะฑะพัั ั ะฟะฐะผัััั

### ะัะธะพัะธัะตั 3 (ะะตะปะฐัะตะปัะฝะพ):
1. ะะพะฑะฐะฒะธัั API ะดะพะบัะผะตะฝัะฐัะธั
2. ะฃะปัััะธัั ะพะฑัะฐะฑะพัะบั ะพัะธะฑะพะบ
3. ะะพะฑะฐะฒะธัั ะปะพะณะธัะพะฒะฐะฝะธะต

---

*ะะฝะฐะปะธะท ะฒัะฟะพะปะฝะตะฝ: 2024*

