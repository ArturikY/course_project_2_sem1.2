# üìä –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫—ç—à–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ —è—á–µ–π–∫–∏

## üîë –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫—ç—à —Å–µ–π—á–∞—Å

### –ö–ª—é—á –∫—ç—à–∞ –¥–ª—è –æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω:
```php
$cacheKey = "hotspots:" . $bbox . ":" . $period . ":" . $threshold . ":" . $gridSize;
```

**–í–∞–∂–Ω–æ:** –ö–ª—é—á –≤–∫–ª—é—á–∞–µ—Ç `gridSize`, –ø–æ—ç—Ç–æ–º—É:
- ‚úÖ –ü—Ä–∏ `gridSize=250` ‚Üí –æ–¥–∏–Ω –∫—ç—à-—Ñ–∞–π–ª
- ‚úÖ –ü—Ä–∏ `gridSize=1000` ‚Üí **–¥—Ä—É–≥–æ–π** –∫—ç—à-—Ñ–∞–π–ª
- ‚ùå –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ —è—á–µ–π–∫–∏ –∫—ç—à **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å—á–µ—Ç

---

## üíª –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ gridSize (250 ‚Üí 1000)

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
```
–ó–∞–ø—Ä–æ—Å: gridSize=1000
–ö–ª—é—á: "hotspots:37.0,55.5,38.0,56.0:30d:5:1000"
–ö—ç—à: –ù–ï –ù–ê–ô–î–ï–ù (–¥—Ä—É–≥–æ–π –∫–ª—é—á)
‚Üí –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ä–∞—Å—á–µ—Ç—É
```

### 2. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
```
‚úÖ –î–∞–Ω–Ω—ã–µ –£–ñ–ï –≤ –ø–∞–º—è—Ç–∏ (singleton pattern)
   - loadAccidentsDataOnce() –∑–∞–≥—Ä—É–∂–∞–µ—Ç –æ–¥–∏–Ω —Ä–∞–∑
   - ~10,000 –∑–∞–ø–∏—Å–µ–π –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
   - –í—Ä–µ–º—è: 0 –º—Å (—É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ)
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ç–∫–∏ —è—á–µ–µ–∫
```
gridSize = 250–º:
  latStep = 250 / 111000 = 0.00225¬∞
  lonStep = 250 / (111000 * cos(55.75¬∞)) ‚âà 0.0039¬∞
  –Ø—á–µ–µ–∫: ~222 √ó 256 = 56,832 —è—á–µ–µ–∫

gridSize = 1000–º:
  latStep = 1000 / 111000 = 0.009¬∞
  lonStep = 1000 / (111000 * cos(55.75¬∞)) ‚âà 0.0156¬∞
  –Ø—á–µ–µ–∫: ~56 √ó 64 = 3,584 —è—á–µ–µ–∫
```

**–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ç–∫–∏:**
- 250–º: ~50-100 –º—Å
- 1000–º: ~5-10 –º—Å (–≤ 16 —Ä–∞–∑ –º–µ–Ω—å—à–µ —è—á–µ–µ–∫!)

### 4. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –î–¢–ü –ø–æ —è—á–µ–π–∫–∞–º
```
–û–ø–µ—Ä–∞—Ü–∏–π: O(n), –≥–¥–µ n = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –î–¢–ü (10,000)
–î–ª—è –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–∏:
  1. –ü—Ä–æ–≤–µ—Ä–∫–∞ bbox (O(1))
  2. –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ (O(1))
  3. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ —è—á–µ–π–∫–∏ (O(1))
  4. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ (O(1))

–í—Ä–µ–º—è: ~50-200 –º—Å (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –î–¢–ü)
```

### 5. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
```
–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ threshold: O(m), –≥–¥–µ m = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —è—á–µ–µ–∫
  - 250–º: ~56,832 —è—á–µ–µ–∫ ‚Üí ~100-200 –º—Å
  - 1000–º: ~3,584 —è—á–µ–π–∫–∏ ‚Üí ~10-20 –º—Å

–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ GeoJSON: ~10-50 –º—Å
```

---

## ‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ gridSize

### –°—Ü–µ–Ω–∞—Ä–∏–π: gridSize 250 ‚Üí 1000

| –≠—Ç–∞–ø | –í—Ä–µ–º—è (250–º) | –í—Ä–µ–º—è (1000–º) | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-------------|--------------|-----------|
| –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö | 0 –º—Å (–∫—ç—à) | 0 –º—Å (–∫—ç—à) | ‚úÖ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ç–∫–∏ | 50-100 –º—Å | 5-10 –º—Å | ‚¨áÔ∏è **-90%** |
| –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –î–¢–ü | 50-200 –º—Å | 50-200 –º—Å | ‚úÖ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è | 100-200 –º—Å | 10-20 –º—Å | ‚¨áÔ∏è **-90%** |
| –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ JSON | 10-50 –º—Å | 5-20 –º—Å | ‚¨áÔ∏è **-60%** |
| **–ò–¢–û–ì–û** | **210-550 –º—Å** | **70-250 –º—Å** | ‚¨áÔ∏è **-60%** |

### –í—ã–≤–æ–¥:
- ‚úÖ **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ gridSize –£–°–ö–û–†–Ø–ï–¢ —Ä–∞—Å—á–µ—Ç** (–º–µ–Ω—å—à–µ —è—á–µ–µ–∫)
- ‚ö†Ô∏è **–ù–æ –∫—ç—à –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** (–¥—Ä—É–≥–æ–π –∫–ª—é—á)
- üíæ **–î–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è** (—É–∂–µ –≤ –ø–∞–º—è—Ç–∏)

---

## üíæ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

### –ü–∞–º—è—Ç—å:
```
–î–∞–Ω–Ω—ã–µ –î–¢–ü (singleton): ~5-10 MB (10,000 –∑–∞–ø–∏—Å–µ–π)
–°–µ—Ç–∫–∞ —è—á–µ–µ–∫ (250–º): ~2-5 MB (56,832 —è—á–µ–µ–∫)
–°–µ—Ç–∫–∞ —è—á–µ–µ–∫ (1000–º): ~0.2-0.5 MB (3,584 —è—á–µ–π–∫–∏)
–ö—ç—à-—Ñ–∞–π–ª: ~0.1-1 MB (JSON)
```

### CPU:
```
–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ç–∫–∏: –ù–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞
–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –î–¢–ü: –°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞ (10,000 –æ–ø–µ—Ä–∞—Ü–∏–π)
–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: –ù–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞
```

### –î–∏—Å–∫:
```
–ß—Ç–µ–Ω–∏–µ –∫—ç—à–∞: 0 –æ–ø–µ—Ä–∞—Ü–∏–π (–∫—ç—à –Ω–µ –Ω–∞–π–¥–µ–Ω)
–ó–∞–ø–∏—Å—å –∫—ç—à–∞: 1 –æ–ø–µ—Ä–∞—Ü–∏—è (~0.1-1 MB)
```

---

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: –£–º–Ω—ã–π –∫—ç—à (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
```php
// –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –î–¢–ü, –∞ –Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á–µ—Ç–∞
// –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ gridSize –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–µ—Ç–∫—É
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ gridSize
- ‚úÖ –ú–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –°–ª–æ–∂–Ω–µ–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö gridSize
```php
// –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö gridSize
// –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –∫—ç—à: 100, 250, 500, 1000, 2000
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ë–æ–ª—å—à–µ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
- ‚ö†Ô∏è –î–æ–ª—å—à–µ –ø–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∫—ç—à
```php
// –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –î–¢–ü –æ—Ç–¥–µ–ª—å–Ω–æ
// –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞ –ø–æ gridSize
// –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ gridSize –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –î–¢–ü
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –ø–∞–º—è—Ç–∏

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫—ç—à–∞

---

## üìà –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤):
- ‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ (singleton)
- ‚úÖ –†–∞—Å—á–µ—Ç –±—ã—Å—Ç—Ä—ã–π (~70-250 –º—Å –¥–ª—è gridSize=1000)
- ‚úÖ –ö—ç—à —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —Å —Ç–µ–º–∏ –∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

### –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–ª—å—à–µ:
1. **–ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –î–¢–ü –æ—Ç–¥–µ–ª—å–Ω–æ** (–Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ gridSize)
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ —É–º–Ω—ã–π –∫–ª—é—á –∫—ç—à–∞** (–∏—Å–∫–ª—é—á–∏—Ç—å gridSize, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —Ç–µ –∂–µ)
3. **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ gridSize**

---

## üß™ –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ó–∞–ø—Ä–æ—Å 1: gridSize=250
```
–í—Ä–µ–º—è: 210-550 –º—Å
–ö—ç—à: MISS
–†–µ–∑—É–ª—å—Ç–∞—Ç: –°–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –∫—ç—à
```

### –ó–∞–ø—Ä–æ—Å 2: gridSize=250 (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π)
```
–í—Ä–µ–º—è: 5-20 –º—Å (–∏–∑ –∫—ç—à–∞)
–ö—ç—à: HIT
```

### –ó–∞–ø—Ä–æ—Å 3: gridSize=1000
```
–í—Ä–µ–º—è: 70-250 –º—Å
–ö—ç—à: MISS (–¥—Ä—É–≥–æ–π –∫–ª—é—á)
–†–µ–∑—É–ª—å—Ç–∞—Ç: –°–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –∫—ç—à
```

### –ó–∞–ø—Ä–æ—Å 4: gridSize=1000 (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π)
```
–í—Ä–µ–º—è: 5-20 –º—Å (–∏–∑ –∫—ç—à–∞)
–ö—ç—à: HIT
```

---

## üí° –í—ã–≤–æ–¥

**–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ gridSize (250 ‚Üí 1000):**

1. ‚úÖ **–î–∞–Ω–Ω—ã–µ –ù–ï –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è** (—É–∂–µ –≤ –ø–∞–º—è—Ç–∏)
2. ‚ö†Ô∏è **–ö—ç—à –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** (–¥—Ä—É–≥–æ–π –∫–ª—é—á)
3. ‚úÖ **–†–∞—Å—á–µ—Ç –ë–´–°–¢–†–ï–ï** (–º–µ–Ω—å—à–µ —è—á–µ–µ–∫)
4. üíæ **–†–µ—Å—É—Ä—Å—ã:** ~70-250 –º—Å CPU, ~0.2-0.5 MB –ø–∞–º—è—Ç–∏, ~0.1-1 MB –¥–∏—Å–∫–∞

**–≠—Ç–æ –ù–ï –º–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–æ–≤** - —Ä–∞—Å—á–µ—Ç –∑–∞–Ω–∏–º–∞–µ—Ç < 1 —Å–µ–∫—É–Ω–¥—ã, –¥–∞–Ω–Ω—ã–µ —É–∂–µ –≤ –ø–∞–º—è—Ç–∏.

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω—É–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —á–∞—Å—Ç–æ –º–µ–Ω—è—é—Ç gridSize
- –ù—É–∂–Ω–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è (< 50 –º—Å)
- –û—á–µ–Ω—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã —Å–µ—Ä–≤–µ—Ä–∞





